import{q as K,r as t,s as ee,x as te,y as re,z as ae}from"./app-fb0093c1.js";import{a as v}from"./index-362795f3.js";import{h as T}from"./moment-fbc5633a.js";import{S as Q}from"./Service-da5c2051.js";import"./dayjs.min-2f06af28.js";const ce=K("calendar",()=>{const s=le();Q();const c=t(new Date().getFullYear()),o=t(new Date().getMonth()),Y=t(new Date().getDate()),e=ee(()=>c.value),A=ee(()=>o.value),f=ee(()=>Y.value);function m(p){c.value=c.value+p}function g(p){c.value=c.value-p}function S(p){if(s.canShowLoading=!0,o.value==11){m(1),o.value=0;return}o.value=o.value+p,console.log(s.isTeamOrg),s.getSelectedEmployeeTeamDetails(s.currentlySelectedTeamMemberUserId),s.getSelectedEmployeeOrgDetails(s.currentlySelectedOrgMemberUserId),s.getSelectedEmployeeAttendance()}function w(p){if(s.canShowLoading=!0,o.value==0){g(1),o.value=11;return}o.value=o.value-p,s.getSelectedEmployeeTeamDetails(s.currentlySelectedTeamMemberUserId),s.getSelectedEmployeeOrgDetails(s.currentlySelectedOrgMemberUserId),s.getSelectedEmployeeAttendance()}function M(p){o.value=p}function E(p){c.value=p}function y(){c.value=new Date().getFullYear(),o.value=new Date().getMonth(),Y.value=new Date().getDate()}return{year:c,month:o,day:Y,getYear:e,getMonth:A,getDay:f,incrementYear:m,incrementMonth:S,decrementMonth:w,setMonth:M,setYear:E,resetDate:y}});te("$swal");const le=K("Timesheet",()=>{const s=ce(),c=Q(),o=t(!0),Y=t(!1),e=t("single"),A=t("Classic"),f=t(),m=t({}),g=t({}),S=t({}),w=t({}),M=t(),E=t(),y=t({}),p=t({}),z=t(!1),C=t(!1),j=t(!1),H=t(!1),k=t(!1),x=t(!1),P=t(),$=t(0),B=t(),_=t(),d=t(),L=t(),D=async(a,n,r)=>{o.value=!0;let b="/fetch-attendance-user-timesheet";try{return await v.post(b,{month:n+1,year:r,user_code:a}).then(G=>(console.log(" getEmployeeAttendance() : "+Object.values(G.data)),G.data))}catch(G){return console.error("Error [ getEmployeeAttendance() ]:",G),null}},h=async()=>{try{return o.value=!0,await D(c.current_user_code,s.getMonth,s.getYear).then(a=>{if(console.log("getSelectedEmployeeAttendance() : "+a),a)console.log("Selected employee attendance : "+a.data),P.value=Object.values(a.data),$.value=Object.values(a.data).length;else return null})}catch(a){console.error("Error [ getSelectedEmployeeAttendance() ]:",a)}finally{o.value=!1}},W=(a,n)=>{e.value=n,o.value=!0,B.value=a,D(a,s.getMonth,s.getYear).then(r=>{_.value=Object.values(r.data)}).catch(r=>{console.log("Error[ getSelectedEmployeeTeamDetails)() ]",r)}).finally(()=>{o.value=!1})},l=async(a,n,r)=>{e.value=n,f.value=r,console.log("employee list select function  ::",f.value),o.value=!0,d.value=a,await D(a,s.getMonth,s.getYear).then(b=>{console.log(" getSelectedEmployeeOrgDetails() : "+Object.values(b.data)),L.value=Object.values(b.data)}).finally(()=>{o.value=!1})},X=async a=>v.post("/fetch-team-members",{user_code:a}),Z=async()=>v.get("/fetch-org-members"),J=a=>a=="biometric"?"fas fa-fingerprint fs-12":a=="web"?"fa fa-laptop fs-12":a=="mobile"?"fa fa-mobile-phone fs-12":"",i=(a,n)=>{let r=f.value;if(c.current_user_role===2){let b={admin_user_code:c.current_user_code,user_code:r,regularization_type:n,attendance_date:a.date,user_time:a.checkin_time,regularize_time:n=="LC"||n=="MIP"?U(M.value):n=="EG"||n=="MOP"?U(E.value):"",reason:a.reason,custom_reason:a.custom_reason?a.custom_reason:""};return M.value=null,E.value=null,b}else{let b={user_code:c.current_user_code,regularization_type:n,attendance_date:a.date,user_time:n=="EG"?a.checkout_time:a.checkin_time,regularize_time:n=="LC"||n=="MIP"?U(M.value):n=="EG"||n=="MOP"?U(E.value):"",reason:a.reason,custom_reason:a.custom_reason?a.custom_reason:""};return M.value=null,E.value=null,b}},u=a=>{j.value=!0,S.value={...a}},I=()=>{o.value=!0;let a;f&&c.current_user_role==2?a="/checkAttendanceEmployeeAdminStatus":a="/attendance-req-regularization",v.post(a,i(S.value,"LC")).then(n=>{h();let r=n.data.message;console.log(r),n.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${r}`,"error")}).finally(()=>{o.value=!1})},F=a=>{H.value=!0,w.value={...a}},q=()=>{let a;f&&c.current_user_role==2?a="/checkAttendanceEmployeeAdminStatus":a="/attendance-req-regularization",o.value=!0,v.post(a,i(w.value,"EG")).then(n=>{h();let r=n.data.message;console.log(r),n.data.status=="success"?Swal.fire("Success!","Attendance Regularized Successful","success"):Swal.fire("Error",`${r}`,"error")}).finally(()=>{o.value=!1})},O=a=>{C.value=!0,g.value={...a}},N=()=>{o.value=!0;let a;f&&c.current_user_role==2?a="/checkAttendanceEmployeeAdminStatus":a="/attendance-req-regularization",v.post(a,i(g.value,"MIP")).then(n=>{h();let r=n.data.message;console.log(r),n.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${r}`,"error")}).finally(()=>{o.value=!1})},V=a=>{z.value=!0,m.value={...a}},se=()=>{let a;f&&c.current_user_role==2?a="/checkAttendanceEmployeeAdminStatus":a="/attendance-req-regularization",o.value=!0,v.post(a,i(m.value,"MOP")).then(n=>{h();let r=n.data.message;console.log(r),n.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${r}`,"error")}).finally(()=>{o.value=!1})},oe=()=>{o.value=!0;let a=f.value;console.log("currentlySelectedUser :: ",a);let n;f&&c.current_user_role==2?n="/checkAbsentEmployeeAdminStatus":n="/attendance-req-absent-regularization",f&&c.current_user_role==2?v.post(n,{admin_user_code:c.current_user_code,user_code:a,attendance_date:y.value.date,regularization_type:"Absent Regularization",checkin_time:U(y.value.start_time),checkout_time:U(y.value.end_time),reason:y.value.reason,custom_reason:y.value.custom_reason?y.value.custom_reason:""}).then(r=>{h();let b=r.data.message;r.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${b}`,"error")}).finally(()=>{o.value=!1}):v.post(n,{user_code:c.current_user_code,attendance_date:y.value.date,regularization_type:"Absent Regularization",checkin_time:U(y.value.start_time),checkout_time:U(y.value.end_time),reason:y.value.reason,custom_reason:y.value.custom_reason?y.value.custom_reason:""}).then(r=>{h();let b=r.data.message;r.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${b}`,"error")}).finally(()=>{o.value=!1})},ne=a=>{k.value=!0,p.value=a},U=a=>{if(a){const[n,r]=a.split(" "),[b,G]=n.split(":");let R=parseInt(b);return r==="PM"&&R!==12?R+=12:r==="AM"&&R===12&&(R=0),`${R.toString().padStart(2,"0")}:${G}:00`}};return{getEmployeeAttendance:D,currentEmployeeAttendance:P,currentEmployeeAttendanceLength:$,getSelectedEmployeeOrgDetails:l,getTeamList:X,getOrgList:Z,getSelectedEmployeeTeamDetails:W,getSelectedEmployeeAttendance:h,CurrentlySelectedUser:f,classicTimesheetSidebar:x,currentlySelectedTeamMemberUserId:B,currentlySelectedTeamMemberAttendance:_,currentlySelectedOrgMemberUserId:d,currentlySelectedOrgMemberAttendance:L,canShowLoading:o,isManager:Y,isTeamOrg:e,findAttendanceMode:J,AttendanceLateOrMipRegularization:M,AttendanceEarylOrMopRegularization:E,onClickShowLcRegularization:u,applyMopRegularization:se,mopDetails:m,dialog_Mop:z,onClickShowEgRegularization:F,applyMipRegularization:N,mipDetails:g,dialog_Mip:C,onClickShowMipRegularization:O,applyLcRegularization:I,lcDetails:S,dialog_Lc:j,onClickShowMopRegularization:V,applyEgRegularization:q,egDetails:w,dialog_Eg:H,dialog_Selfie:k,onClickSViewSelfie:ne,selfieDetails:p,switchTimesheet:A,absentRegularizationDetails:y,applyAbsentRegularization:oe}}),ue=K("useLeaveModuleStore",()=>{Q();const s=t(!0),c=t(),o=t(),Y=t(),e=t(),A=t(),f=t(),m=t(),g=t(),S=t(),w=t(),M=t(),E=t(!1),y=t({}),p=_=>{E.value=!0,console.log(_),y.value={..._},y.emp_name=_.name};async function z(){s.value=!0;let _="/get-employee-leave-balance";await v.get(_).then(d=>{console.log(d.data),c.value=d.data,o.value=d.data["Avalied Leaves"]}).finally(()=>{s.value=!1})}async function C(_){await v.post("/leave/withdrawLeave",{leave_id:_}).then(d=>{console.log("performLeaveWithdraw() : "+d.data)}).finally(()=>{s.value=!1})}async function j(_,d,L){let D=0;await v.get(window.location.origin+"/currentUserCode ").then(h=>{D=h.data}),await v.post("/attendance/getEmployeeLeaveDetails",{user_code:D,filter_month:_,filter_year:d,filter_leave_status:L}).then(h=>{Y.value=h.data.data,console.log("getEmployeeLeaveHistory() : "+h.data)}).finally(()=>{s.value=!1})}async function H(_,d,L){let D=0;await v.get(window.location.origin+"/currentUserCode ").then(h=>{D=h.data}),v.post("/attendance/getTeamEmployeesLeaveDetails",{manager_code:D,filter_month:_,filter_year:d,filter_leave_status:L}).then(h=>{e.value=h.data.data,console.log("getTeamLeaveHistory() : "+h.data)}).finally(()=>{s.value=!1})}async function k(_,d,L){v.post("/attendance/getAllEmployeesLeaveDetails",{filter_month:_,filter_year:d,filter_leave_status:L}).then(D=>{A.value=D.data.data,console.log("getOrgLeaveHistory() : "+D.data.data)}).finally(()=>{s.value=!1})}async function x(_){v.post("/attendance/getLeaveInformation",{record_id:_}).then(d=>{M.value=d.data.data,console.log("getLeaveInformation() : "+d.data)}).finally(()=>{s.value=!1})}async function P(_,d){await v.post("/fetch-org-leaves-balance",{start_date:_,end_date:d}).then(L=>{f.value=L.data}).finally(()=>{s.value=!1,m.value="",g.value=""})}async function $(_,d){console.log(_,d),v.post("/fetch-team-leave-balance",{start_date:_,end_date:d}).then(L=>{w.value=L.data}).finally(()=>{m.value="",g.value="",s.value=!1})}function B(){m.value="",g.value="",console.log(" this variable is cleared ::",g.value,m.value)}return{canShowLoading:s,canShowLeaveDetails:E,setLeaveDetails:y,getLeaveDetails:p,array_employeeLeaveHistory:Y,array_teamLeaveHistory:e,array_orgLeaveHistory:A,array_employeeLeaveBalance:c,array_employeeAvailedLeaveBalance:o,array_orgLeaveBalance:f,selectedStartDate:m,selectedEndDate:g,canshowloadingsrceen:S,arrayTermLeaveBalance:w,performLeaveWithdraw:C,getEmployeeLeaveHistory:j,getTeamLeaveHistory:H,getAllEmployeesLeaveHistory:k,getLeaveInformation:x,getEmployeeLeaveBalance:z,getOrgLeaveBalance:P,getTermLeaveBalance:$,clearfunction:B}});te("$swal");const ye=K("useLeaveService",()=>{const s=re(),c=Q(),o=ue(),Y=le(),e=ae({current_login_user:"",selected_leave:"",full_day_leave_date:"",half_day_leave_date:"",half_day_leave_session:"",radiobtn_full_day:"",radiobtn_half_day:"",radiobtn_custom:"",custom_start_date:"",custom_end_date:"",custom_total_days:"",permission_date:"",permission_start_time:"",permission_total_time:"",permission_end_time:"",compensatory_leaves:"",compensatory_leaves_dates:"",selected_compensatory_leaves:"",compensatory_start_date:"",compensatory_total_days:"",compensatory_end_date:"",notifyTo:"",leave_reason:"",leave_request_error_message:""}),A=t(!1),f=t(!0),m=t(!0),g=t(!1),S=t(!1),w=t(!1),M=t(!1),E=t(),y=t();let p=new Date;const z=t(!1),C=t(!1),j=t(!1),H=t(!1);let k=new Date;k.setDate(p.getDate()-1),E.value=[p,k];const x=t(),P=()=>{e.radiobtn_full_day=="full_day"?m.value=!0:m.value=!1,m.value=!0,S.value=!1,w.value=!1,g.value=!1,M.value=!1},$=()=>{e.radiobtn_half_day=="half_day"?g.value=!0:g.value=!1,g.value=!0,S.value=!1,w.value=!1,m.value=!1,M.value=!1},B=()=>{e.radiobtn_custom=="custom"?S.value=!0:S.value=!1,S.value=!0,w.value=!1,g.value=!1,m.value=!1,M.value=!1},_=()=>{S.value==!0&&(e.custom_start_date.length<0||e.custom_start_date=="")&&s.add({severity:"info",summary:"Info Message",detail:"Select Start date",life:3e3}),w.value==!0&&(e.permission_start_time<0||e.permission_start_time=="")&&s.add({severity:"info",summary:"Info Message",detail:"Select Start Time",life:3e3}),new Date().toJSON().slice(0,10);var i=new Date(e.custom_start_date);console.log(e.custom_start_date);var u=new Date(e.custom_end_date);console.log(e.custom_end_date);var O=u.getTime()-i.getTime();console.log("Differenece"+O);var N=(O/(1e3*60*60*24)).toFixed(0);let I=N;console.log(I),e.custom_total_days=parseInt(I)+1,console.log(e.custom_total_days);var F=new Date(e.compensatory_start_date);console.log(e.compensatory_start_date);var q=new Date(e.compensatory_end_date);console.log(e.compensatory_end_date);var O=q.getTime()-F.getTime();console.log("Differenece"+O);var N=(O/(1e3*60*60*24)).toFixed(0);let V=N;console.log(V),e.compensatory_total_days=parseInt(V)+1,console.log(e.compensatory_total_days)},d=()=>{let i=T(e.full_day_leave_date).format("YYYY-MM-DD"),u=e.permission_start_time.toString();u=i+" "+u.substring(16,24);let I=e.permission_end_time.toString();I=i+" "+I.substring(16,24),console.log();let F=new Date(e.permission_start_time).getTime(),q=new Date(e.permission_end_time).getTime();console.log("start"+F,"end"+q);var O=((q-F)/1e3/60/60).toFixed(0);e.permission_total_time=O,console.log(O)},L=()=>{e.selected_leave.includes("Permission")?(w.value=!0,f.value=!1,g.value=!1,S.value=!1,M.value=!1,m.value=!1):e.selected_leave.includes("Compensatory")?(M.value=!0,w.value=!1,m.value=!1,g.value=!1,S.value=!1,f.value=!1,W(),e.compensatory_leaves_dates=T(e.compensatory_leaves.emp_attendance_date).format("dddd DD-MMM-YYYY"),console.log("kn"+e.compensatory_leaves.emp_attendance_date)):e.selected_leave=="Select"?(M.value=!1,w.value=!1,m.value=!0,g.value=!1,S.value=!1,f.value=!0):(w.value=!1,M.value=!1,f.value=!0,m.value=!0)},D=()=>{v.get("/currentUser").then(i=>{e.current_login_user=i.data,C.value=!1}).catch(i=>{console.log(i)})},h=()=>{v.get("/fetch-leave-policy-details").then(i=>{console.log(i.data),y.value=i.data})},W=()=>{e.current_login_user,v.get("/fetch-employee-unused-compensatory-days").then(i=>{e.compensatory_leaves=i.data}).catch(i=>{console.log(i)})},l=ae({leave_type_id:1,leave_Request_date:T().format("YYYY-MM-DD  HH:mm:ss"),leave_type_name:"",leave_session:"",start_date:"",end_date:"",no_of_days:"",hours_diff:"",notify_to:"",leave_reason:"",compensatory_leave_id:[],user_type:"Employee"}),X=()=>{location.reload()},Z=async()=>{if(l.leave_type_name=e.selected_leave,e.radiobtn_full_day=="full_day")console.log("Full day leave : "+e.full_day_leave_date),l.no_of_days=1,l.start_date=T(e.full_day_leave_date).format("YYYY-MM-DD"),l.end_date=l.start_date,l.leave_session="";else if(e.radiobtn_half_day=="half_day")if(console.log("Applying half-day leave on : "+e.half_day_leave_date),l.no_of_days=.5,console.log("half day leave date"+e.half_day_leave_date),l.start_date=T(e.half_day_leave_date).format("YYYY-MM-DD"),l.end_date=l.start_date,e.half_day_leave_session=="forenoon")l.leave_session="FN";else if(e.half_day_leave_session=="afternoon")l.leave_session="AN";else{s.add({severity:"info",summary:"Select Session",detail:"Select Leave Session",life:3e3});return}else if(e.radiobtn_custom=="custom")l.start_date=T(e.custom_start_date).format("YYYY-MM-DD"),l.end_date=T(e.custom_end_date).format("YYYY-MM-DD"),l.no_of_days=e.custom_total_days,l.leave_session="";else if(e.selected_leave.includes("Compensatory")){l.start_date=T(e.compensatory_start_date).format("YYYY-MM-DD"),l.end_date=T(e.compensatory_end_date).format("YYYY-MM-DD"),l.no_of_days=e.compensatory_total_days;let u=Object.values(e.selected_compensatory_leaves).length;console.log("Selected Compensatory No.of days : "+e.compensatory_total_days),console.log("Selected Compensatory Leaves : "+u);const I=Object.values(e.selected_compensatory_leaves);if(parseInt(e.compensatory_total_days)!=u){s.add({severity:"info",summary:"Error",detail:"Compensatory leaves doesnt match with available leave days",life:3e3});return}else I.map(F=>{let q=F.emp_attendance_id;l.compensatory_leave_id.push(q),console.log(l.compensatory_leave_id)})}else e.selected_leave.includes("Permission")?(l.start_date=T(e.permission_date).format("YYYY-MM-DD"),l.end_date=l.start_date,l.hours_diff=e.permission_total_time):s.add({severity:"info",summary:"Info Message",detail:"Select Leave",life:3e3});l.notify_to=e.notifyTo,l.leave_reason=e.leave_reason,z.value=!0,console.log(l),C.value=!0;let i;c.current_user_role==2&&Y.CurrentlySelectedUser?(console.log(Y.CurrentlySelectedUser),i="applyLeaveRequest_AdminRole",v.post(i,{admin_user_code:c.current_user_code,user_code:Y.CurrentlySelectedUser,leave_request_date:l.leave_Request_date,leave_type_name:l.leave_type_name,leave_session:l.leave_session,start_date:l.start_date,end_date:l.end_date,no_of_days:l.no_of_days,hours_diff:l.hours_diff,compensatory_work_days_ids:l.compensatory_leave_id,notify_to:l.notify_to,leave_reason:l.leave_reason,user_type:l.user_type}).then(u=>{C.value=!1,console.log(u.data.messege),u.data.status=="success"&&Swal.fire("Success",u.data.message,"success"),u.data.status=="failure"&&Swal.fire("Failure",u.data.message,"error"),console.log("Email status"+u.data.status)}).catch(u=>{console.log(u)}).finally(()=>{J(),A.value=!1})):(i="/applyLeaveRequest",v.post(i,{user_code:c.current_user_code,leave_request_date:l.leave_Request_date,leave_type_name:l.leave_type_name,leave_session:l.leave_session,start_date:l.start_date,end_date:l.end_date,no_of_days:l.no_of_days,hours_diff:l.hours_diff,compensatory_work_days_ids:l.compensatory_leave_id,notify_to:l.notify_to,leave_reason:l.leave_reason,user_type:l.user_type}).then(u=>{C.value=!1,console.log(u.data.messege),u.data.status=="success"&&Swal.fire("Success",u.data.message,"success"),u.data.status=="failure"&&Swal.fire("Failure",u.data.message,"error"),console.log("Email status"+u.data.status)}).catch(u=>{console.log(u)}).finally(()=>{o.getTermLeaveBalance(),o.getEmployeeLeaveHistory(),J(),A.value=!1}))},J=()=>{e.current_login_user=null,e.selected_leave=null,e.full_day_leave_date=null,e.half_day_leave_date=null,e.half_day_leave_session=null,e.radiobtn_full_day=null,e.radiobtn_half_day=null,e.radiobtn_custom=null,e.custom_start_date=null,e.custom_end_date=null,e.custom_total_days=null,e.permission_date=null,e.permission_start_time=null,e.permission_total_time=null,e.permission_end_time=null,e.compensatory_leaves=null,e.compensatory_leaves_dates=null,e.selected_compensatory_leaves=null,e.compensatory_start_date=null,e.compensatory_total_days=null,e.compensatory_end_date=null,e.notifyTo=null,e.leave_reason=null,e.leave_request_error_message=null};return{leaveApplyDailog:A,leave_data:e,invalidDate:k,today:p,invalidDates:E,toast:s,leave_Request_data:l,leave_types:y,data_checking:C,Email_Service:j,Email_Error:H,selected_compensatory_leaves:x,half_day:$,full_day:P,custom_day:B,Permission:L,Submit:Z,ReloadPage:X,dayCalculation:_,time_difference:d,get_user:D,get_leave_types:h,get_compensatroy_leaves:W,full_day_format:m,half_day_format:g,custom_format:S,Permission_format:w,compensatory_format:M,TotalNoOfDays:f,RequiredField:z}});export{ce as a,le as b,ue as c,ye as u};
