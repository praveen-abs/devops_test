import{B as n,X as q,E as X,c as j,h as t,w as s,e as i,j as u,V as _,a1 as B,F as Z,K as S,g as p,o as F,t as f,n as ee,a as te,G as oe,P as ae,H as le,R as se,q as ne}from"./toastservice.esm-be32db1e.js";import{T as ie,B as re,S as de,b as ce,a as pe}from"./styleclass.esm-ba8fdf63.js";import"./blockui.esm-dd521861.js";import{u as ue,C as me,F as ve,b as fe,s as be,a as ge}from"./inputtext.esm-e9caa4ce.js";import{s as _e}from"./confirmdialog.esm-bc3d19a4.js";import{D as he}from"./dialogservice.esm-7f45f84c.js";import{s as we}from"./toast.esm-798d9fce.js";import{s as ye}from"./progressspinner.esm-08c4bf67.js";import{s as Se}from"./row.esm-6ebc942e.js";import{s as xe}from"./columngroup.esm-9dd1458e.js";import{s as Ce}from"./calendar.esm-edf22c1b.js";import{h as O}from"./moment-fbc5633a.js";import{s as Re}from"./checkbox.esm-dabc85a7.js";import{a as I}from"./index-f7a317fc.js";const ke=i("h5",null,"Do you want to approve all?",-1),Ae={class:"flex justify-content-between align-items-center"},De={class:"flex justify-content-between align-items-center"},Te=["disabled"],Pe=i("i",{class:"fa fa-cog me-2"},null,-1),Ue=["disabled"],Ve=i("i",{class:"fas fa-file-download me-2"},null,-1),$e=i("h5",{style:{"text-align":"center"}},"Please wait...",-1),Ne=i("h5",{style:{"text-align":"center"}},"Please wait...",-1),Me={class:"confirmation-content"},Ee=i("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem"}},null,-1),Le={key:0},je={class:"orders-subtable"},Be={style:{"white-space":"nowrap"}},Fe={__name:"ReimbursementsApproval",setup(Ie){let x=n(),b=n(!1),h=n(!1);const g=n(!1);ue();const Y=q();n(!0);const T=n([]);n(!1),n(!1);const C=n();n(),n(!0),n({global:{value:null,matchMode:S.CONTAINS},name:{value:null,matchMode:S.STARTS_WITH,matchMode:S.EQUALS,matchMode:S.CONTAINS},status:{value:null,matchMode:S.EQUALS}});const z=n(["Pending","Approved","Rejected"]);let m=null,R=null;const H=n(!0);X(()=>{x.value=[],v.value=new Date,console.log(v.value)});function P(l,o){b.value=!0,m=o,R=l,console.log("Selected Row Data : "+JSON.stringify(l))}function U(l){b.value=!1,l&&D()}function D(){m="",R=null}const v=n(),w=n();n(!1);const k=n(!1),V=n(),$=()=>{let l=new Date(v.value),o=l.getFullYear(),y=l.getMonth()+1;console.log(v.value.toString()),console.log(V),g.value=!0,I.post(window.location.origin+"/fetch_all_reimbursements_as_groups",{selected_year:o,selected_month:y,selected_status:w.value}).then(d=>{console.log("data sent"),console.log("data from "+d.employee_name),x.value=d.data,V.value=d.data,g.value=!1}).catch(d=>{console.log(d)})},G=()=>{let l=new Date(v.value);g.value=!0;let o=l.getFullYear(),y=l.getMonth()+1;H.value=!1;let d="/reports/generate-manager-reimbursements-reports?selected_year="+o+"&selected_month="+y+"&selected_status="+w.value+"&_token={{ csrf_token() }}";window.location=d,setTimeout(N,1e3)},N=()=>{g.value=!1};setTimeout(N,3e3);function J(){U(!1),console.log("Processing Rowdata : "+JSON.stringify(R)),console.log("currentlySelectedStatus : "+m),I.post(window.location.origin+"/reimbursements_bulk_approval",{reimbursement_id:R,status:m=="Approve"?"Approved":m=="Reject"?"Rejected":m,reviewer_comments:""}).then(l=>{console.log(l),$(),Y.add({severity:"success",summary:"",detail:" Successfully Approved !",life:3e3}),D()}).catch(l=>{h.value=!1,D(),console.log(l.toJSON())})}return n(),(l,o)=>{const y=p("Toast"),d=p("Button"),A=p("Dialog"),K=p("Calendar"),W=p("Dropdown"),M=p("ProgressSpinner"),r=p("Column"),Q=p("InputText"),E=p("DataTable");return F(),j(Z,null,[t(y),t(A,{visible:k.value,"onUpdate:visible":o[2]||(o[2]=e=>k.value=e),modal:"",header:"Header",style:{width:"25vw"}},{footer:s(()=>[t(d,{label:"No",icon:"pi pi-times",onClick:o[0]||(o[0]=e=>k.value=!1),text:""}),t(d,{label:"Yes",icon:"pi pi-check",onClick:o[1]||(o[1]=e=>k.value=!1),autofocus:""})]),default:s(()=>[ke]),_:1},8,["visible"]),i("div",Ae,[i("div",De,[t(K,{modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=e=>v.value=e),view:"month",dateFormat:"mm/yy",class:"",style:{border:"1px solid orange","border-radius":"7px"}},null,8,["modelValue"]),t(W,{modelValue:w.value,"onUpdate:modelValue":o[4]||(o[4]=e=>w.value=e),options:z.value,placeholder:"Status",class:"w-full mx-3 md:w-14rem",style:{border:"1px solid orange","border-radius":"7px"}},null,8,["modelValue","options"]),i("button",{label:"Submit",class:"btn btn-primary",severity:"danger",disabled:!w.value!="",onClick:$},[Pe,u(" Generate")],8,Te)]),i("button",{class:"btn btn-primary",disabled:_(x)=="",severity:"success",onClick:G},[Ve,u("Download")],8,Ue)]),i("div",null,[t(A,{header:"Header",visible:g.value,"onUpdate:visible":o[5]||(o[5]=e=>g.value=e),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"25vw"},modal:!0,closable:!1,closeOnEscape:!1},{header:s(()=>[t(M,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:"2s","aria-label":"Custom ProgressSpinner"})]),footer:s(()=>[$e]),_:1},8,["visible"]),t(A,{header:"Header",visible:_(h),"onUpdate:visible":o[6]||(o[6]=e=>B(h)?h.value=e:h=e),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"25vw"},modal:!0,closable:!1,closeOnEscape:!1},{header:s(()=>[t(M,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:"2s","aria-label":"Custom ProgressSpinner"})]),footer:s(()=>[Ne]),_:1},8,["visible"]),t(A,{header:"Confirmation",visible:_(b),"onUpdate:visible":o[9]||(o[9]=e=>B(b)?b.value=e:b=e),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{footer:s(()=>[t(d,{label:"Yes",icon:"pi pi-check",onClick:o[7]||(o[7]=e=>J()),class:"p-button-text",autofocus:""}),t(d,{label:"No",icon:"pi pi-times",onClick:o[8]||(o[8]=e=>U(!0)),class:"p-button-text"})]),default:s(()=>[i("div",Me,[Ee,i("span",null,"Are you sure you want to "+f(_(m))+"?",1)])]),_:1},8,["visible"]),i("div",null,[t(E,{value:_(x),paginator:!0,rows:10,class:"mt-6",dataKey:"user_id",onRowExpand:l.onRowExpand,onRowCollapse:l.onRowCollapse,expandedRows:T.value,"onUpdate:expandedRows":o[11]||(o[11]=e=>T.value=e),selection:C.value,"onUpdate:selection":o[12]||(o[12]=e=>C.value=e),selectAll:l.selectAll,onSelectAllChange:l.onSelectAllChange,onRowSelect:l.onRowSelect,onRowUnselect:l.onRowUnselect,paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",responsiveLayout:"scroll",currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},{empty:s(()=>[u(" No Reimbursement data for the selected status filter ")]),loading:s(()=>[u(" Loading customers data. Please wait. ")]),expansion:s(e=>[i("div",je,[t(E,{value:e.data.reimbursement_data,responsiveLayout:"scroll",selection:C.value,"onUpdate:selection":o[10]||(o[10]=c=>C.value=c),selectAll:l.selectAll,onSelectAllChange:l.onSelectAllChange},{default:s(()=>[t(r,{field:"",header:"Date",sortable:""},{body:s(c=>[i("p",Be,f(_(O)(c.data.date).format("DD-MMM-YYYY")),1)]),_:2},1024),t(r,{field:"from",header:"From"}),t(r,{field:"to",header:"To"}),t(r,{field:"user_comments",header:"Comments"}),t(r,{field:"vehicle_type",header:"Mode of transport"}),t(r,{class:"fontSize13px",field:"distance_travelled",header:"Distance Covered"}),t(r,{class:"fontSize13px",field:"total_expenses",header:"Total Expenses"},{body:s(c=>[u(f("₹ "+c.data.total_expenses),1)]),_:2},1024),t(r,{field:"status",header:"Status",sortable:""},{body:s(c=>[i("span",{class:ee("order-badge order-"+c.data.status)},f(c.data.status),3)]),_:2},1024)]),_:2},1032,["value","selection","selectAll","onSelectAllChange"])])]),default:s(()=>[t(r,{expander:!0}),t(r,{selectionMode:"multiple",style:{width:"1rem"},exportable:!1}),t(r,{field:"user_code",header:"Employee Id",sortable:""}),t(r,{field:"name",header:"Employee Name"},{body:s(e=>[u(f(e.data.employee_name),1)]),filter:s(({filterModel:e,filterCallback:c})=>[t(Q,{modelValue:e.value,"onUpdate:modelValue":L=>e.value=L,onInput:L=>c(),placeholder:"Search",class:"p-column-filter",showClear:!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),t(r,{class:"fontSize13px",field:"total_distance_travelled",header:"Overall Distance Travelled",sortable:!1},{body:s(e=>[u(f(e.data.total_distance_travelled+" KM"),1)]),_:1}),t(r,{class:"fontSize13px",field:"total_expenses",header:"Overall Reimbursements",sortable:!1},{body:s(e=>[u(f("₹ "+e.data.total_expenses),1)]),_:1}),t(r,{field:"",header:"Action"},{body:s(e=>[e.data.has_pending_reimbursements=="true"?(F(),j("span",Le,[t(d,{type:"button",icon:"pi pi-check-circle",class:"p-button-success Button",label:"Approve",onClick:c=>P(e.data,"Approve"),style:{height:"2.5em"}},null,8,["onClick"]),t(d,{type:"button",icon:"pi pi-times-circle",class:"p-button-danger Button",label:"Reject",style:{"margin-left":"8px",height:"2.5em"},onClick:c=>P(e.data,"Reject")},null,8,["onClick"])])):te("",!0)]),_:1})]),_:1},8,["value","onRowExpand","onRowCollapse","expandedRows","selection","selectAll","onSelectAllChange","onRowSelect","onRowUnselect"])])])],64)}}},a=oe(Fe);a.use(ae,{ripple:!0});a.use(me);a.use(le);a.use(he);a.directive("tooltip",ie);a.directive("badge",re);a.directive("ripple",se);a.directive("styleclass",de);a.directive("focustrap",ve);a.component("Button",ne);a.component("DataTable",ce);a.component("Column",pe);a.component("ColumnGroup",xe);a.component("Row",Se);a.component("Toast",we);a.component("ConfirmDialog",_e);a.component("Dropdown",fe);a.component("InputText",be);a.component("Dialog",ge);a.component("ProgressSpinner",ye);a.component("Calendar",Ce);a.component("moment",O);a.component("Checkbox",Re);a.mount("#vjs_reimbursementsApprovalTable");
