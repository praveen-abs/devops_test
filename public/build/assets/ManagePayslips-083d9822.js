import{B as m,E as A,M as H,c as M,e as o,h as l,W as u,w as y,F as N,g as b,o as $,a as T,t as L,G as U,P as Y,H as B,R as j,q as z}from"./toastservice.esm-c4f6de4c.js";import{T as O,B as G,S as I,b as W,a as q}from"./styleclass.esm-ea560a03.js";import"./blockui.esm-85692cd0.js";import{C as J,F as K,a as Q,b as X,s as Z}from"./inputtext.esm-5faf66bf.js";import{s as ee}from"./confirmdialog.esm-51539a4d.js";import{s as ae}from"./toast.esm-8d255b70.js";import{s as te}from"./progressspinner.esm-455f2fd3.js";import{s as le}from"./calendar.esm-7c3ebc21.js";import{d as se,c as oe}from"./pinia-0f325ab3.js";import{a as D}from"./index-f7a317fc.js";const ie=se("managePayslipStore",()=>{const R=m(),e=m(),w=m(),r=m(!1);async function g(n,p){r.value=!0,R.value="",await D.post("getAllEmployeesPayslipDetails",{month:n,year:p}).then(d=>{R.value=d.data.data}).finally(()=>{r.value=!1})}async function P(n,p,d){r.value=!0,await D.post("/payroll/paycheck/getEmployeePayslipDetailsAsHTML",{user_code:n,month:p,year:d}).then(c=>{w.value=c.data}).finally(()=>{r.value=!1})}async function _(n,p,d){console.log("sendMail_employeePayslip() : Sending mail to user : "+n),r.value=!0,D.post("/payroll/paycheck/sendMail_employeePayslip",{user_code:n,month:p,year:d}).then(c=>{console.log(" Response [sendMail_employeePayslip] : "+c.data.data)}).catch(c=>{console.log(c)}).finally(()=>{r.value=!1})}async function S(n,p,d,c){console.log("updatePayslipReleaseStatus() : Updating releasepayslip status to user : "+n);let f=new Date(e.value);D.post("/payroll/paycheck/updatePayslipReleaseStatus",{user_code:n,month:p,year:d,status:c}).then(s=>{console.log(" Response [updatePayslipReleaseStatus] : "+s.data.data)}).catch(s=>{console.log(s.data.data)}).finally(()=>{g(f.getMonth()+1,f.getFullYear())})}async function C(n,p,d,c){console.log("downloadPayslipReleaseStatus() : Updating releasepayslip status to user : "+n),new Date(e.value),D.post("/paycheck/employee_payslip/downloadPayslipReleaseStatus",{user_code:n,month:p,year:d,status:c}).then(f=>{console.log(" Response [downloadPayslipReleaseStatus] : "+JSON.stringify(f.data.data)),window.open(`data:application/pdf;base64,${f.data.data}`)}).catch(f=>{console.log(f)})}return{array_employees_list:R,paySlipHTMLView:w,selectedPayRollDate:e,loading:r,getAllEmployeesPayslipDetails:g,getEmployeePayslipDetailsAsHTML:P,sendMail_employeePayslip:_,updatePayslipReleaseStatus:S,downloadPayslipReleaseStatus:C}});const ne={class:"d-flex justify-content-end"},re=o("label",{for:"",class:"my-2 text-lg font-semibold"},"Select Month",-1),pe={class:"my-4"},de={class:"d-flex flex-column"},ce=["onClick"],ue={key:0,class:"text-success mt-2"},ye={key:1,class:"text-danger mt-2"},me=["onClick"],fe=o("div",null," Payslip Sent ",-1),ve=o("div",{class:"confirmation-content"},[o("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem"}}),o("span",null,"Are you sure you want to send Mail ?")],-1),ge={class:"d-flex mt-11",style:{position:"relative",right:"-180px",width:"140px"}},_e={class:"confirmation-content"},he=o("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem"}},null,-1),Pe={class:"d-flex mt-11",style:{position:"relative",right:"-180px",width:"140px"}},we={class:"confirmation-content"},be=o("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem"}},null,-1),xe={class:"d-flex mt-11",style:{position:"relative",right:"-180px",width:"140px"}},De={class:"card flex justify-content-center inline-flex"},Re=["innerHTML"],Se=o("h5",{style:{"text-align":"center"}},"Please wait...",-1),Ce={__name:"ManagePayslips",setup(R){const e=ie(),w=m(!1),r=m(!1),g=m(!1),P=m(!1);m();const _=m();A(()=>{e.selectedPayRollDate=new Date("03/03/2023"),e.getAllEmployeesPayslipDetails(e.selectedPayRollDate.getMonth()+1,e.selectedPayRollDate.getFullYear())}),H(()=>{if(e.is_released==1)return"Released"});async function S(s){console.log("Showing payslip html for (user_code, month): "+s+" , "+parseInt(e.selectedPayRollDate.getMonth()+1)),await e.getEmployeePayslipDetailsAsHTML(s,e.selectedPayRollDate.getMonth()+1,e.selectedPayRollDate.getFullYear()),w.value=!0}function C(s){_.value=s,r.value=!0}function n(s){_.value=s,g.value=!0}function p(s){_.value=s,P.value=!0}async function d(s){await e.sendMail_employeePayslip(s,e.selectedPayRollDate.getMonth()+1,e.selectedPayRollDate.getFullYear()),r.value=!1}async function c(s){await e.updatePayslipReleaseStatus(s,e.selectedPayRollDate.getMonth()+1,e.selectedPayRollDate.getFullYear(),1),g.value=!1}async function f(s){await e.downloadPayslipReleaseStatus(s,e.selectedPayRollDate.getMonth()+1,e.selectedPayRollDate.getFullYear()),P.value=!1}return(s,t)=>{const F=b("Calendar"),v=b("Button"),h=b("Column"),V=b("DataTable"),x=b("Dialog"),E=b("ProgressSpinner");return $(),M(N,null,[o("div",ne,[re,l(F,{view:"month",dateFormat:"mm/yy",class:"mx-4",modelValue:u(e).selectedPayRollDate,"onUpdate:modelValue":t[0]||(t[0]=a=>u(e).selectedPayRollDate=a),style:{border:"1px solid orange","border-radius":"7px",height:"38px"}},null,8,["modelValue"]),l(v,{class:"h-10 mb-2 btn btn-orange",label:"Generate",onClick:t[1]||(t[1]=a=>u(e).getAllEmployeesPayslipDetails(u(e).selectedPayRollDate.getMonth()+1,u(e).selectedPayRollDate.getFullYear()))})]),o("div",pe,[l(V,{value:u(e).array_employees_list,paginator:!0,rows:10,dataKey:"id",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Records",responsiveLayout:"scroll",filters:s.filters,"onUpdate:filters":t[2]||(t[2]=a=>s.filters=a),filterDisplay:"menu",loading:s.loading2,globalFilterFields:["name","status"]},{default:y(()=>[l(h,{headerStyle:"width: 3rem"}),l(h,{field:"user_code",header:"Employee Code",headerStyle:"width: 3rem"}),l(h,{field:"name",header:"Employee Name"}),l(h,{field:"email",header:"Personal Mail"}),l(h,{field:"is_released",header:"Payslip Status"},{body:y(a=>[o("div",de,[o("button",{class:"btn-primary rounded",style:{padding:"4px 0 !important","margin-top":"10px"},onClick:k=>n(a.data.user_code)},"Release payslip",8,ce),a.data.is_released==1?($(),M("h1",ue," Released ")):T("",!0),a.data.is_released==0||a.data.is_released==null?($(),M("h1",ye," Not Released ")):T("",!0)])]),_:1}),l(h,{field:"is_payslip_mail_sent",header:"Mail Status"},{body:y(a=>[o("button",{class:"btn-primary rounded",onClick:k=>C(a.data.user_code)},"Send Payslip",8,me),fe]),_:1}),l(h,{header:"Download"},{body:y(a=>[l(v,{class:"btn-primary",style:{},label:"Download",onClick:k=>p(a.data.user_code)},null,8,["onClick"])]),_:1}),l(h,{header:"View Payslip"},{body:y(a=>[l(v,{class:"btn-primary",style:{},label:"View",onClick:k=>S(a.data.user_code)},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters","loading"])]),l(x,{header:"Confirmation",visible:r.value,"onUpdate:visible":t[5]||(t[5]=a=>r.value=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{default:y(()=>[ve,o("div",ge,[l(v,{class:"btn-primary mr-3 py-2",label:"Yes",icon:"pi pi-check",onClick:t[3]||(t[3]=a=>d(_.value)),autofocus:""}),l(v,{label:"No",icon:"pi pi-times",onClick:t[4]||(t[4]=a=>r.value=!1),class:"p-button-text py-2",autofocus:""})])]),_:1},8,["visible"]),l(x,{header:"Confirmation",visible:g.value,"onUpdate:visible":t[8]||(t[8]=a=>g.value=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{default:y(()=>[o("div",_e,[he,o("span",null,"Are you sure you want to release payslip? "+L(u(e).name),1)]),o("div",Pe,[l(v,{class:"btn-primary py-2 mr-3",label:"Yes",icon:"pi pi-check",onClick:t[6]||(t[6]=a=>c(_.value)),autofocus:""}),l(v,{label:"No",icon:"pi pi-times",onClick:t[7]||(t[7]=a=>g.value=!1),class:"p-button-text py-2",autofocus:""})])]),_:1},8,["visible"]),l(x,{header:"Confirmation",visible:P.value,"onUpdate:visible":t[11]||(t[11]=a=>P.value=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{default:y(()=>[o("div",we,[be,o("span",null,"Are you sure you want to download payslip? "+L(u(e).name),1)]),o("div",xe,[l(v,{class:"btn-primary py-2 mr-3",label:"Yes",icon:"pi pi-check",onClick:t[9]||(t[9]=a=>f(_.value)),autofocus:""}),l(v,{label:"No",icon:"pi pi-times",onClick:t[10]||(t[10]=a=>P.value=!1),class:"p-button-text py-2",autofocus:""})])]),_:1},8,["visible"]),o("div",De,[l(x,{visible:w.value,"onUpdate:visible":t[12]||(t[12]=a=>w.value=a),modal:"",header:"payslip",style:{width:"50vw"}},{default:y(()=>[o("div",{innerHTML:u(e).paySlipHTMLView},null,8,Re)]),_:1},8,["visible"])]),l(x,{header:"Header",visible:u(e).loading,"onUpdate:visible":t[13]||(t[13]=a=>u(e).loading=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"25vw"},modal:!0,closable:!1,closeOnEscape:!1},{header:y(()=>[l(E,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:"2s","aria-label":"Custom ProgressSpinner"})]),footer:y(()=>[Se]),_:1},8,["visible"])],64)}}},i=U(Ce),ke=oe();i.use(Y,{ripple:!0});i.use(J);i.use(B);i.use(ke);i.directive("tooltip",O);i.directive("badge",G);i.directive("ripple",j);i.directive("styleclass",I);i.directive("focustrap",K);i.component("Button",z);i.component("DataTable",W);i.component("Column",q);i.component("ConfirmDialog",ee);i.component("Toast",ae);i.component("Dialog",Q);i.component("Dropdown",X);i.component("ProgressSpinner",te);i.component("InputText",Z);i.component("Calendar",le);i.mount("#vjs_manage_payslips");
