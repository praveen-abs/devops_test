import{d as Q}from"./pinia-641035e3.js";import{u as re}from"./toastservice.esm-8d63d505.js";import{a as p}from"./index-362795f3.js";import{h as b}from"./moment-fbc5633a.js";import{S as V}from"./Service-4ef425c0.js";import{Q as s,a5 as J,$ as Z,W as X}from"./inputnumber.esm-e362c3ab.js";const ue=Q("calendar",()=>{const r=ee();V();const c=s(new Date().getFullYear()),l=s(new Date().getMonth()),e=s(new Date().getDate()),A=J(()=>c.value),E=J(()=>l.value),_=J(()=>e.value);function f(m){c.value=c.value+m}function v(m){c.value=c.value-m}function y(m){if(r.canShowLoading=!0,l.value==11){f(1),l.value=0;return}l.value=l.value+m,console.log(r.isTeamOrg),r.getSelectedEmployeeTeamDetails(r.currentlySelectedTeamMemberUserId),r.getSelectedEmployeeOrgDetails(r.currentlySelectedOrgMemberUserId),r.getSelectedEmployeeAttendance()}function g(m){if(r.canShowLoading=!0,l.value==0){v(1),l.value=11;return}l.value=l.value-m,r.getSelectedEmployeeTeamDetails(r.currentlySelectedTeamMemberUserId),r.getSelectedEmployeeOrgDetails(r.currentlySelectedOrgMemberUserId),r.getSelectedEmployeeAttendance()}function M(m){l.value=m}function D(m){c.value=m}function d(){c.value=new Date().getFullYear(),l.value=new Date().getMonth(),e.value=new Date().getDate()}return{year:c,month:l,day:e,getYear:A,getMonth:E,getDay:_,incrementYear:f,incrementMonth:y,decrementMonth:g,setMonth:M,setYear:D,resetDate:d}});Z("$swal");const ee=Q("Timesheet",()=>{const r=ue(),c=V(),l=s(!0),e=s(!1),A=s("single"),E=s("Classic"),_=s(),f=s({}),v=s({}),y=s({}),g=s({}),M=s(),D=s(),d=s({}),m=s({}),C=s(!1),q=s(!1),U=s(!1),F=s(!1),P=s(!1),B=s(!1),j=s(),$=s(0),G=s(),x=s(),R=s(),N=s(),I=async(a,o,n)=>{l.value=!0;let h="/fetch-attendance-user-timesheet";return await p.post(h,{month:o+1,year:n,user_id:a})},Y=async()=>{try{l.value=!0,await I(c.current_user_id,r.getMonth,r.getYear).then(a=>{console.log("Selected employee attendance : "+a.data),j.value=Object.values(a.data),$.value=Object.values(a.data).length}).finally(()=>{l.value=!1})}catch(a){console.error("Error:",a)}},t=(a,o)=>{A.value=o,l.value=!0,G.value=a,I(a,r.getMonth,r.getYear).then(n=>{x.value=Object.values(n.data)}).finally(()=>{l.value=!1})},W=(a,o,n)=>{A.value=o,_.value=n,console.log("employee list select function  ::",_.value),l.value=!0,R.value=a,I(a,r.getMonth,r.getYear).then(h=>{N.value=Object.values(h.data)}).finally(()=>{l.value=!1})},K=async a=>p.post("/fetch-team-members",{user_code:a}),i=async()=>p.get("/fetch-org-members"),u=a=>a=="biometric"?"fas fa-fingerprint fs-12":a=="web"?"fa fa-laptop fs-12":a=="mobile"?"fa fa-mobile-phone fs-12":"",S=(a,o)=>{let n=_.value;if(c.current_user_role===2){let h={admin_user_code:c.current_user_code,user_code:n,regularization_type:o,attendance_date:a.date,user_time:a.checkin_time,regularize_time:o=="LC"||o=="MIP"?L(M.value):o=="EG"||o=="MOP"?L(D.value):"",reason:a.reason,custom_reason:a.custom_reason?a.custom_reason:""};return M.value=null,D.value=null,h}else{let h={user_code:c.current_user_code,regularization_type:o,attendance_date:a.date,user_time:a.checkin_time,regularize_time:o=="LC"||o=="MIP"?L(M.value):o=="EG"||o=="MOP"?L(D.value):"",reason:a.reason,custom_reason:a.custom_reason?a.custom_reason:""};return M.value=null,D.value=null,h}},O=a=>{U.value=!0,y.value={...a}},k=()=>{l.value=!0;let a;_&&c.current_user_role==2?a="/checkAttendanceEmployeeAdminStatus":a="/attendance-req-regularization",p.post(a,S(y.value,"LC")).then(o=>{Y();let n=o.data.message;console.log(n),o.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${n}`,"error")}).finally(()=>{l.value=!1})},w=a=>{F.value=!0,g.value={...a}},T=()=>{let a;_&&c.current_user_role==2?a="/checkAttendanceEmployeeAdminStatus":a="/attendance-req-regularization",l.value=!0,p.post(a,S(g.value,"EG")).then(o=>{Y();let n=o.data.message;console.log(n),o.data.status=="success"?Swal.fire("Success!","Attendance Regularized Successful","success"):Swal.fire("Error",`${n}`,"error")}).finally(()=>{l.value=!1})},H=a=>{q.value=!0,v.value={...a}},ae=()=>{l.value=!0;let a;_&&c.current_user_role==2?a="/checkAttendanceEmployeeAdminStatus":a="/attendance-req-regularization",p.post(a,S(v.value,"MIP")).then(o=>{Y();let n=o.data.message;console.log(n),o.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${n}`,"error")}).finally(()=>{l.value=!1})},te=a=>{C.value=!0,f.value={...a}},se=()=>{let a;_&&c.current_user_role==2?a="/checkAttendanceEmployeeAdminStatus":a="/attendance-req-regularization",l.value=!0,p.post(a,S(f.value,"MOP")).then(o=>{Y();let n=o.data.message;console.log(n),o.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${n}`,"error")}).finally(()=>{l.value=!1})},le=()=>{l.value=!0;let a=_.value;console.log("currentlySelectedUser :: ",a);let o;_&&c.current_user_role==2?o="/checkAbsentEmployeeAdminStatus":o="/attendance-req-regularization",_&&c.current_user_role==2?p.post(o,{admin_user_code:c.current_user_code,user_code:a,attendance_date:d.value.date,regularization_type:"Absent Regularization",checkin_time:L(d.value.start_time),checkout_time:L(d.value.end_time),reason:d.value.reason,custom_reason:d.value.custom_reason?d.value.custom_reason:""}).then(n=>{Y();let h=n.data.message;n.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${h}`,"error")}).finally(()=>{l.value=!1}):p.post(o,{user_code:c.current_user_code,attendance_date:d.value.date,regularization_type:"Absent Regularization",checkin_time:L(d.value.start_time),checkout_time:L(d.value.end_time),reason:d.value.reason,custom_reason:d.value.custom_reason?d.value.custom_reason:""}).then(n=>{Y();let h=n.data.message;n.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${h}`,"error")}).finally(()=>{l.value=!1})},oe=a=>{P.value=!0,m.value=a},L=a=>{if(a){const[o,n]=a.split(" "),[h,ne]=o.split(":");let z=parseInt(h);return n==="PM"&&z!==12?z+=12:n==="AM"&&z===12&&(z=0),`${z.toString().padStart(2,"0")}:${ne}:00`}};return{getEmployeeAttendance:I,currentEmployeeAttendance:j,currentEmployeeAttendanceLength:$,getSelectedEmployeeOrgDetails:W,getTeamList:K,getOrgList:i,getSelectedEmployeeTeamDetails:t,getSelectedEmployeeAttendance:Y,CurrentlySelectedUser:_,classicTimesheetSidebar:B,currentlySelectedTeamMemberUserId:G,currentlySelectedTeamMemberAttendance:x,currentlySelectedOrgMemberUserId:R,currentlySelectedOrgMemberAttendance:N,canShowLoading:l,isManager:e,isTeamOrg:A,findAttendanceMode:u,AttendanceLateOrMipRegularization:M,AttendanceEarylOrMopRegularization:D,onClickShowLcRegularization:O,applyMopRegularization:se,mopDetails:f,dialog_Mop:C,onClickShowEgRegularization:w,applyMipRegularization:ae,mipDetails:v,dialog_Mip:q,onClickShowMipRegularization:H,applyLcRegularization:k,lcDetails:y,dialog_Lc:U,onClickShowMopRegularization:te,applyEgRegularization:T,egDetails:g,dialog_Eg:F,dialog_Selfie:P,onClickSViewSelfie:oe,selfieDetails:m,switchTimesheet:E,absentRegularizationDetails:d,applyAbsentRegularization:le}});Z("$swal");const ye=Q("useLeaveService",()=>{const r=re(),c=V(),l=ee(),e=X({current_login_user:"",selected_leave:"",full_day_leave_date:"",half_day_leave_date:"",half_day_leave_session:"",radiobtn_full_day:"",radiobtn_half_day:"",radiobtn_custom:"",custom_start_date:"",custom_end_date:"",custom_total_days:"",permission_date:"",permission_start_time:"",permission_total_time:"",permission_end_time:"",compensatory_leaves:"",compensatory_leaves_dates:"",selected_compensatory_leaves:"",compensatory_start_date:"",compensatory_total_days:"",compensatory_end_date:"",notifyTo:"",leave_reason:"",leave_request_error_message:""}),A=s(!1),E=s(!0),_=s(!0),f=s(!1),v=s(!1),y=s(!1),g=s(!1),M=s(),D=s();let d=new Date;const m=s(!1),C=s(!1),q=s(!1),U=s(!1);let F=new Date;F.setDate(d.getDate()-1),M.value=[d,F];const P=s(),B=()=>{e.radiobtn_full_day=="full_day"?_.value=!0:_.value=!1,_.value=!0,v.value=!1,y.value=!1,f.value=!1,g.value=!1},j=()=>{e.radiobtn_half_day=="half_day"?f.value=!0:f.value=!1,f.value=!0,v.value=!1,y.value=!1,_.value=!1,g.value=!1},$=()=>{e.radiobtn_custom=="custom"?v.value=!0:v.value=!1,v.value=!0,y.value=!1,f.value=!1,_.value=!1,g.value=!1},G=()=>{v.value==!0&&(e.custom_start_date.length<0||e.custom_start_date=="")&&r.add({severity:"info",summary:"Info Message",detail:"Select Start date",life:3e3}),y.value==!0&&(e.permission_start_time<0||e.permission_start_time=="")&&r.add({severity:"info",summary:"Info Message",detail:"Select Start Time",life:3e3}),new Date().toJSON().slice(0,10);var i=new Date(e.custom_start_date);console.log(e.custom_start_date);var u=new Date(e.custom_end_date);console.log(e.custom_end_date);var w=u.getTime()-i.getTime();console.log("Differenece"+w);var T=(w/(1e3*60*60*24)).toFixed(0);let S=T;console.log(S),e.custom_total_days=parseInt(S)+1,console.log(e.custom_total_days);var O=new Date(e.compensatory_start_date);console.log(e.compensatory_start_date);var k=new Date(e.compensatory_end_date);console.log(e.compensatory_end_date);var w=k.getTime()-O.getTime();console.log("Differenece"+w);var T=(w/(1e3*60*60*24)).toFixed(0);let H=T;console.log(H),e.compensatory_total_days=parseInt(H)+1,console.log(e.compensatory_total_days)},x=()=>{let i=b(e.full_day_leave_date).format("YYYY-MM-DD"),u=e.permission_start_time.toString();u=i+" "+u.substring(16,24);let S=e.permission_end_time.toString();S=i+" "+S.substring(16,24),console.log();let O=new Date(e.permission_start_time).getTime(),k=new Date(e.permission_end_time).getTime();console.log("start"+O,"end"+k);var w=((k-O)/1e3/60/60).toFixed(0);e.permission_total_time=w,console.log(w)},R=()=>{e.selected_leave.includes("Permission")?(y.value=!0,E.value=!1,f.value=!1,v.value=!1,g.value=!1,_.value=!1):e.selected_leave.includes("Compensatory")?(g.value=!0,y.value=!1,_.value=!1,f.value=!1,v.value=!1,E.value=!1,Y(),e.compensatory_leaves_dates=b(e.compensatory_leaves.emp_attendance_date).format("dddd DD-MMM-YYYY"),console.log("kn"+e.compensatory_leaves.emp_attendance_date)):e.selected_leave=="Select"?(g.value=!1,y.value=!1,_.value=!0,f.value=!1,v.value=!1,E.value=!0):(y.value=!1,g.value=!1,E.value=!0,_.value=!0)},N=()=>{p.get("/currentUser").then(i=>{e.current_login_user=i.data,C.value=!1}).catch(i=>{console.log(i)})},I=()=>{p.get("/fetch-leave-policy-details").then(i=>{console.log(i.data),D.value=i.data})},Y=()=>{e.current_login_user,p.get("/fetch-employee-unused-compensatory-days").then(i=>{e.compensatory_leaves=i.data}).catch(i=>{console.log(i)})},t=X({leave_type_id:1,leave_Request_date:b().format("YYYY-MM-DD  HH:mm:ss"),leave_type_name:"",leave_session:"",start_date:"",end_date:"",no_of_days:"",hours_diff:"",notify_to:"",leave_reason:"",compensatory_leave_id:[],user_type:"Employee"});return{leaveApplyDailog:A,leave_data:e,invalidDate:F,today:d,invalidDates:M,toast:r,leave_Request_data:t,leave_types:D,data_checking:C,Email_Service:q,Email_Error:U,selected_compensatory_leaves:P,half_day:j,full_day:B,custom_day:$,Permission:R,Submit:async()=>{if(t.leave_type_name=e.selected_leave,e.radiobtn_full_day=="full_day")console.log("Full day leave : "+e.full_day_leave_date),t.no_of_days=1,t.start_date=b(e.full_day_leave_date).format("YYYY-MM-DD"),t.end_date=t.start_date,t.leave_session="";else if(e.radiobtn_half_day=="half_day")if(console.log("Applying half-day leave on : "+e.half_day_leave_date),t.no_of_days=.5,console.log("half day leave date"+e.half_day_leave_date),t.start_date=b(e.half_day_leave_date).format("YYYY-MM-DD"),t.end_date=t.start_date,e.half_day_leave_session=="forenoon")t.leave_session="FN";else if(e.half_day_leave_session=="afternoon")t.leave_session="AN";else{r.add({severity:"info",summary:"Select Session",detail:"Select Leave Session",life:3e3});return}else if(e.radiobtn_custom=="custom")t.start_date=b(e.custom_start_date).format("YYYY-MM-DD"),t.end_date=b(e.custom_end_date).format("YYYY-MM-DD"),t.no_of_days=e.custom_total_days,t.leave_session="";else if(e.selected_leave.includes("Compensatory")){t.start_date=b(e.compensatory_start_date).format("YYYY-MM-DD"),t.end_date=b(e.compensatory_end_date).format("YYYY-MM-DD"),t.no_of_days=e.compensatory_total_days;let u=Object.values(e.selected_compensatory_leaves).length;console.log("Selected Compensatory No.of days : "+e.compensatory_total_days),console.log("Selected Compensatory Leaves : "+u);const S=Object.values(e.selected_compensatory_leaves);if(parseInt(e.compensatory_total_days)!=u){r.add({severity:"info",summary:"Error",detail:"Compensatory leaves doesnt match with available leave days",life:3e3});return}else S.map(O=>{let k=O.emp_attendance_id;t.compensatory_leave_id.push(k),console.log(t.compensatory_leave_id)})}else e.selected_leave.includes("Permission")?(t.start_date=b(e.permission_date).format("YYYY-MM-DD"),t.end_date=t.start_date,t.hours_diff=e.permission_total_time):r.add({severity:"info",summary:"Info Message",detail:"Select Leave",life:3e3});t.notify_to=e.notifyTo,t.leave_reason=e.leave_reason,m.value=!0,console.log(t),C.value=!0;let i;c.current_user_role==2&&l.CurrentlySelectedUser?(console.log(l.CurrentlySelectedUser),i="applyLeaveRequest_AdminRole",p.post(i,{admin_user_code:c.current_user_code,user_code:l.CurrentlySelectedUser,leave_request_date:t.leave_Request_date,leave_type_name:t.leave_type_name,leave_session:t.leave_session,start_date:t.start_date,end_date:t.end_date,no_of_days:t.no_of_days,hours_diff:t.hours_diff,compensatory_work_days_ids:t.compensatory_leave_id,notify_to:t.notify_to,leave_reason:t.leave_reason,user_type:t.user_type}).then(u=>{C.value=!1,console.log(u.data.messege),u.data.status=="success"&&Swal.fire("Success",u.data.message,"success"),u.data.status=="failure"&&Swal.fire("Failure",u.data.message,"error"),console.log("Email status"+u.data.status)}).catch(u=>{console.log(u)}).finally(()=>{A.value=!1})):(i="/applyLeaveRequest",p.post(i,{user_code:c.current_user_code,leave_request_date:t.leave_Request_date,leave_type_name:t.leave_type_name,leave_session:t.leave_session,start_date:t.start_date,end_date:t.end_date,no_of_days:t.no_of_days,hours_diff:t.hours_diff,compensatory_work_days_ids:t.compensatory_leave_id,notify_to:t.notify_to,leave_reason:t.leave_reason,user_type:t.user_type}).then(u=>{C.value=!1,console.log(u.data.messege),u.data.status=="success"&&Swal.fire("Success",u.data.message,"success"),u.data.status=="failure"&&Swal.fire("Failure",u.data.message,"error"),console.log("Email status"+u.data.status)}).catch(u=>{console.log(u)}).finally(()=>{A.value=!1}))},ReloadPage:()=>{location.reload()},dayCalculation:G,time_difference:x,get_user:N,get_leave_types:I,get_compensatroy_leaves:Y,full_day_format:_,half_day_format:f,custom_format:v,Permission_format:y,compensatory_format:g,TotalNoOfDays:E,RequiredField:m}});export{ue as a,ee as b,ye as u};
