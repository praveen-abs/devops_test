import{d as U}from"./pinia-ef13c18a.js";import{a7 as j,ai as H,a3 as I,a0 as o}from"./toastservice.esm-484a3f44.js";import{a as p}from"./index-362795f3.js";import{h as r}from"./moment-fbc5633a.js";j("$swal");const Q=U("useLeaveService",()=>{const f=H(),e=I({current_login_user:"",selected_leave:"",full_day_leave_date:"",half_day_leave_date:"",half_day_leave_session:"",radiobtn_full_day:"",radiobtn_half_day:"",radiobtn_custom:"",custom_start_date:"",custom_end_date:"",custom_total_days:"",permission_date:"",permission_start_time:"",permission_total_time:"",permission_end_time:"",compensatory_leaves:"",compensatory_leaves_dates:"",selected_compensatory_leaves:"",compensatory_start_date:"",compensatory_total_days:"",compensatory_end_date:"",notifyTo:"",leave_reason:"",leave_request_error_message:""}),D=o(!1),y=o(!0),l=o(!0),d=o(!1),_=o(!1),i=o(!1),c=o(!1),M=o(),b=o();let h=new Date;const w=o(!1),g=o(!1),L=o(!1),q=o(!1);let Y=new Date;Y.setDate(h.getDate()-1),M.value=[h,Y];const x=o(),F=()=>{e.radiobtn_full_day=="full_day"?l.value=!0:l.value=!1,l.value=!0,_.value=!1,i.value=!1,d.value=!1,c.value=!1},R=()=>{e.radiobtn_half_day=="half_day"?d.value=!0:d.value=!1,_.value=!1,i.value=!1,l.value=!1,c.value=!1,d.value=!0},E=()=>{e.radiobtn_custom=="custom"?_.value=!0:_.value=!1,_.value=!0,i.value=!1,d.value=!1,l.value=!1,c.value=!1},N=()=>{_.value==!0&&(e.custom_start_date.length<0||e.custom_start_date=="")&&f.add({severity:"info",summary:"Info Message",detail:"Select Start date",life:3e3}),i.value==!0&&(e.permission_start_time<0||e.permission_start_time=="")&&f.add({severity:"info",summary:"Info Message",detail:"Select Start Time",life:3e3}),new Date().toJSON().slice(0,10);var t=new Date(e.custom_start_date);console.log(e.custom_start_date);var u=new Date(e.custom_end_date);console.log(e.custom_end_date);var n=u.getTime()-t.getTime();console.log("Differenece"+n);var S=(n/(1e3*60*60*24)).toFixed(0);let s=S;console.log(s),e.custom_total_days=parseInt(s)+1,console.log(e.custom_total_days);var m=new Date(e.compensatory_start_date);console.log(e.compensatory_start_date);var v=new Date(e.compensatory_end_date);console.log(e.compensatory_end_date);var n=v.getTime()-m.getTime();console.log("Differenece"+n);var S=(n/(1e3*60*60*24)).toFixed(0);let T=S;console.log(T),e.compensatory_total_days=parseInt(T)+1,console.log(e.compensatory_total_days)},P=()=>{let t=r(e.full_day_leave_date).format("YYYY-MM-DD"),u=e.permission_start_time.toString();u=t+" "+u.substring(16,24);let s=e.permission_end_time.toString();s=t+" "+s.substring(16,24),console.log();let m=new Date(e.permission_start_time).getTime(),v=new Date(e.permission_end_time).getTime();console.log("start"+m,"end"+v);var n=((v-m)/1e3/60/60).toFixed(0);e.permission_total_time=n,console.log(n)},A=()=>{e.selected_leave.includes("Permission")?(i.value=!0,y.value=!1,d.value=!1,_.value=!1,c.value=!1,l.value=!1):e.selected_leave.includes("Compensatory")?(c.value=!0,i.value=!1,l.value=!1,d.value=!1,_.value=!1,y.value=!1,C(),e.compensatory_leaves_dates=r(e.compensatory_leaves.emp_attendance_date).format("dddd DD-MMM-YYYY"),console.log("kn"+e.compensatory_leaves.emp_attendance_date)):e.selected_leave=="Select"?(c.value=!1,i.value=!1,l.value=!0,d.value=!1,_.value=!1,y.value=!0):(i.value=!1,c.value=!1,y.value=!0,l.value=!0)},k=()=>{p.get("/currentUser").then(t=>{e.current_login_user=t.data,g.value=!1}).catch(t=>{console.log(t)})},O=()=>{p.get("/fetch-leave-policy-details").then(t=>{console.log(t.data),b.value=t.data})},C=()=>{e.current_login_user,p.get("/fetch-employee-unused-compensatory-days").then(t=>{e.compensatory_leaves=t.data}).catch(t=>{console.log(t)})},a=I({leave_type_id:1,leave_Request_date:r().format("YYYY-MM-DD  HH:mm:ss"),leave_type_name:"",leave_session:"",start_date:"",end_date:"",no_of_days:"",hours_diff:"",notify_to:"",leave_reason:"",compensatory_leave_id:[]});return{leaveApplyDailog:D,leave_data:e,invalidDate:Y,today:h,invalidDates:M,toast:f,leave_Request_data:a,leave_types:b,data_checking:g,Email_Service:L,Email_Error:q,selected_compensatory_leaves:x,half_day:R,full_day:F,custom_day:E,Permission:A,Submit:async()=>{let t="NULL";await p.get("/currentUserCode").then(u=>{if(t=u.data,console.log("Current UserCode : "+t),a.leave_type_name=e.selected_leave,e.radiobtn_full_day=="full_day")console.log("Full day leave : "+e.full_day_leave_date),a.no_of_days=1,a.start_date=r(e.full_day_leave_date).format("YYYY-MM-DD"),a.end_date=a.start_date,a.leave_session="";else if(e.radiobtn_half_day=="half_day")if(console.log("Applying half-day leave on : "+e.half_day_leave_date),a.no_of_days=.5,console.log("half day leave date"+e.half_day_leave_date),a.start_date=r(e.half_day_leave_date).format("YYYY-MM-DD"),a.end_date=a.start_date,e.half_day_leave_session=="forenoon")a.leave_session="FN";else if(e.half_day_leave_session=="afternoon")a.leave_session="AN";else{f.add({severity:"info",summary:"Select Session",detail:"Select Leave Session",life:3e3});return}else if(e.radiobtn_custom=="custom")a.start_date=r(e.custom_start_date).format("YYYY-MM-DD"),a.end_date=r(e.custom_end_date).format("YYYY-MM-DD"),a.no_of_days=e.custom_total_days,a.leave_session="";else if(e.selected_leave.includes("Compensatory")){a.start_date=r(e.compensatory_start_date).format("YYYY-MM-DD"),a.end_date=r(e.compensatory_end_date).format("YYYY-MM-DD"),a.no_of_days=e.compensatory_total_days;let s=Object.values(e.selected_compensatory_leaves).length;console.log("Selected Compensatory No.of days : "+e.compensatory_total_days),console.log("Selected Compensatory Leaves : "+s);const m=Object.values(e.selected_compensatory_leaves);if(parseInt(e.compensatory_total_days)!=s){f.add({severity:"info",summary:"Error",detail:"Compensatory leaves doesnt match with available leave days",life:3e3});return}else m.map(v=>{let n=v.emp_attendance_id;a.compensatory_leave_id.push(n),console.log(a.compensatory_leave_id)})}else e.selected_leave.includes("Permission")?(a.start_date=r(e.permission_date).format("YYYY-MM-DD"),a.end_date=a.start_date,a.hours_diff=e.permission_total_time):f.add({severity:"info",summary:"Info Message",detail:"Select Leave",life:3e3});a.notify_to=e.notifyTo,a.leave_reason=e.leave_reason,w.value=!0,console.log(a),g.value=!0,p.post("/applyLeaveRequest",{user_code:t,leave_request_date:a.leave_Request_date,leave_type_name:a.leave_type_name,leave_session:a.leave_session,start_date:a.start_date,end_date:a.end_date,no_of_days:a.no_of_days,hours_diff:a.hours_diff,compensatory_work_days_ids:a.compensatory_leave_id,notify_to:a.notify_to,leave_reason:a.leave_reason,user_type:"Employee"}).then(s=>{g.value=!1,console.log(s.data.messege),s.data.status=="success"&&Swal.fire("Success",s.data.message,"success"),s.data.status=="failure"&&Swal.fire("Failure",s.data.message,"error"),console.log("Email status"+s.data.status)}).catch(s=>{console.log(s)}).finally(()=>{D.value=!1})}).catch(u=>{console.log(u)}).finally(()=>{D.value=!1})},ReloadPage:()=>{location.reload()},dayCalculation:N,time_difference:P,get_user:k,get_leave_types:O,get_compensatroy_leaves:C,full_day_format:l,half_day_format:d,custom_format:_,Permission_format:i,compensatory_format:c,TotalNoOfDays:y,RequiredField:w}});export{Q as u};
