import{V as n,Q as q,X as Z,c as O,e as i,h as o,j as p,Y as h,w as l,a2 as B,F as ee,L as S,W as T,g as u,o as F,t as _,n as te,a as oe,E as ae,P as se,G as le,R as ne,q as ie}from"./index-39918fa6.js";import{u as re,C as de,T as ce,B as ue,S as pe,F as me,d as ve,c as fe,f as _e,b as ge,e as be}from"./styleclass.esm-f772d017.js";import"./blockui.esm-a7a43aa2.js";import{s as he}from"./confirmdialog.esm-9db873da.js";import{D as we}from"./dialogservice.esm-20532b1b.js";import{s as ye}from"./toast.esm-daf18d83.js";import{s as xe}from"./progressspinner.esm-2f2847cf.js";import{s as Se}from"./row.esm-6ebc942e.js";import{s as Ce}from"./columngroup.esm-9dd1458e.js";import{s as Re}from"./calendar.esm-d70260b0.js";import{h as I}from"./moment-fbc5633a.js";const De={class:"flex justify-content-between align-items-center"},ke={class:"flex justify-content-between align-items-center"},Te=["disabled"],Ae=i("i",{class:"fa fa-cog me-2"},null,-1),Pe=["disabled"],Ve=i("i",{class:"fas fa-file-download me-2"},null,-1),Me=i("h5",{style:{"text-align":"center"}},"Please wait...",-1),Le=i("h5",{style:{"text-align":"center"}},"Please wait...",-1),Ne={class:"confirmation-content"},je=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Ee={key:0},Ue={class:"orders-subtable"},$e={style:{"white-space":"nowrap"}},Oe={__name:"ReimbursementsApproval",setup(Be){let w=n(),g=n(!1),m=n(!1);const b=n(!1);re();const Y=q();n(!0);const A=n([]);n(!1),n(!1);const P=n(),V=n();n({global:{value:null,matchMode:S.CONTAINS},name:{value:null,matchMode:S.STARTS_WITH,matchMode:S.EQUALS,matchMode:S.CONTAINS},status:{value:null,matchMode:S.EQUALS}});const z=n(["Pending","Approved","Rejected"]);let v=null,C=null;const G=n(!0);Z(()=>{w.value=[],f.value=new Date,console.log(f.value)});function J(){let s=window.location.origin+"/fetch_all_reimbursements_as_groups";console.log("AJAX URL : "+s),T.get(s).then(t=>{w.value=t.data,console.log(t.data),console.log(Object.keys(t.data))})}function M(s,t){g.value=!0,v=t,C=s,console.log("Selected Row Data : "+JSON.stringify(s))}function L(s){g.value=!1,s&&D()}function D(){v="",C=null}const f=n(),y=n();n(!1);const N=n(),W=()=>{let s=new Date(f.value),t=s.getFullYear(),x=s.getMonth()+1;console.log(f.value.toString()),console.log(N),b.value=!0,T.post(window.location.origin+"/fetch_all_reimbursements_as_groups",{selected_year:t,selected_month:x,selected_status:y.value}).then(c=>{console.log("data sent"),console.log("data from "+c.employee_name),w.value=c.data,N.value=c.data,b.value=!1}).catch(c=>{console.log(c)})},H=()=>{let s=new Date(f.value);b.value=!0;let t=s.getFullYear(),x=s.getMonth()+1;G.value=!1;let c="/reports/generate-manager-reimbursements-reports?selected_year="+t+"&selected_month="+x+"&selected_status="+y.value+"&_token={{ csrf_token() }}";window.location=c,setTimeout(j,1e3)},j=()=>{b.value=!1};setTimeout(j,3e3);function Q(){L(!1),m.value=!0,console.log("Processing Rowdata : "+JSON.stringify(C)),console.log("currentlySelectedStatus : "+v),T.post(window.location.origin+"/reimbursements_bulk_approval",{reimbursement_id:C,status:v=="Approve"?"Approved":v=="Reject"?"Rejected":v,reviewer_comments:""}).then(s=>{console.log(s),m.value=!1,Y.add({severity:"success",summary:"",detail:" Successfully Approved !",life:3e3}),J(),D()}).catch(s=>{m.value=!1,D(),console.log(s.toJSON())})}return(s,t)=>{const x=u("Calendar"),c=u("Dropdown"),K=u("Toast"),E=u("ProgressSpinner"),k=u("Dialog"),R=u("Button"),r=u("Column"),X=u("InputText"),U=u("DataTable");return F(),O(ee,null,[i("div",De,[i("div",ke,[o(x,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),view:"month",dateFormat:"mm/yy",class:""},null,8,["modelValue"]),o(c,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value=e),options:z.value,placeholder:"Status",class:"w-full md:w-14rem mx-3"},null,8,["modelValue","options"]),i("button",{label:"Submit",class:"btn btn-primary",severity:"danger",disabled:!y.value!="",onClick:W},[Ae,p(" Generate")],8,Te)]),i("button",{class:"btn btn-primary",disabled:h(w)=="",severity:"success",onClick:H},[Ve,p("Download")],8,Pe)]),i("div",null,[o(K),o(k,{header:"Header",visible:b.value,"onUpdate:visible":t[2]||(t[2]=e=>b.value=e),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"25vw"},modal:!0,closable:!1,closeOnEscape:!1},{header:l(()=>[o(E,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:"2s","aria-label":"Custom ProgressSpinner"})]),footer:l(()=>[Me]),_:1},8,["visible"]),o(k,{header:"Header",visible:h(m),"onUpdate:visible":t[3]||(t[3]=e=>B(m)?m.value=e:m=e),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"25vw"},modal:!0,closable:!1,closeOnEscape:!1},{header:l(()=>[o(E,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:"2s","aria-label":"Custom ProgressSpinner"})]),footer:l(()=>[Le]),_:1},8,["visible"]),o(k,{header:"Confirmation",visible:h(g),"onUpdate:visible":t[6]||(t[6]=e=>B(g)?g.value=e:g=e),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{footer:l(()=>[o(R,{label:"Yes",icon:"pi pi-check",onClick:t[4]||(t[4]=e=>Q()),class:"p-button-text",autofocus:""}),o(R,{label:"No",icon:"pi pi-times",onClick:t[5]||(t[5]=e=>L(!0)),class:"p-button-text"})]),default:l(()=>[i("div",Ne,[je,i("span",null,"Are you sure you want to "+_(h(v))+"?",1)])]),_:1},8,["visible"]),i("div",null,[o(U,{value:h(w),paginator:!0,rows:10,class:"mt-6",dataKey:"user_id",onRowExpand:s.onRowExpand,onRowCollapse:s.onRowCollapse,expandedRows:A.value,"onUpdate:expandedRows":t[8]||(t[8]=e=>A.value=e),selection:P.value,"onUpdate:selection":t[9]||(t[9]=e=>P.value=e),paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",responsiveLayout:"scroll",currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},{empty:l(()=>[p(" No Reimbursement data for the selected status filter ")]),loading:l(()=>[p(" Loading customers data. Please wait. ")]),expansion:l(e=>[i("div",Ue,[o(U,{value:e.data.reimbursement_data,responsiveLayout:"scroll",selection:V.value,"onUpdate:selection":t[7]||(t[7]=d=>V.value=d)},{default:l(()=>[o(r,{selectionMode:"multiple",style:{width:"3rem"},exportable:!1}),o(r,{field:"",header:"Date",sortable:""},{body:l(d=>[i("p",$e,_(h(I)(d.data.date).format("DD-MMM-YYYY")),1)]),_:2},1024),o(r,{field:"from",header:"From"}),o(r,{field:"to",header:"To"}),o(r,{field:"vehicle_type",header:"Mode of transport"}),o(r,{class:"fontSize13px",field:"distance_travelled",header:"Distance Covered"}),o(r,{class:"fontSize13px",field:"total_expenses",header:"Total Expenses"},{body:l(d=>[p(_("₹ "+d.data.total_expenses),1)]),_:2},1024),o(r,{field:"status",header:"Status",sortable:""},{body:l(d=>[i("span",{class:te("order-badge order-"+d.data.status)},_(d.data.status),3)]),_:2},1024)]),_:2},1032,["value","selection"])])]),default:l(()=>[o(r,{expander:!0,headerStyle:"width: 0.5rem"}),o(r,{selectionMode:"multiple",style:{width:"3rem"},exportable:!1}),o(r,{field:"user_code",header:"Employee Id",sortable:""}),o(r,{field:"name",header:"Employee Name"},{body:l(e=>[p(_(e.data.employee_name),1)]),filter:l(({filterModel:e,filterCallback:d})=>[o(X,{modelValue:e.value,"onUpdate:modelValue":$=>e.value=$,onInput:$=>d(),placeholder:"Search",class:"p-column-filter",showClear:!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),o(r,{class:"fontSize13px",field:"total_distance_travelled",header:"Overall Distance Travelled",sortable:!1},{body:l(e=>[p(_(e.data.total_distance_travelled+" KM"),1)]),_:1}),o(r,{class:"fontSize13px",field:"total_expenses",header:"Overall Reimbursements",sortable:!1},{body:l(e=>[p(_("₹ "+e.data.total_expenses),1)]),_:1}),o(r,{field:"",header:"Action"},{body:l(e=>[e.data.has_pending_reimbursements=="true"?(F(),O("span",Ee,[o(R,{type:"button",icon:"pi pi-check-circle",class:"p-button-success Button",label:"Approve",onClick:d=>M(e.data,"Approve"),style:{height:"2.5em"}},null,8,["onClick"]),o(R,{type:"button",icon:"pi pi-times-circle",class:"p-button-danger Button",label:"Reject",style:{"margin-left":"8px",height:"2.5em"},onClick:d=>M(e.data,"Reject")},null,8,["onClick"])])):oe("",!0)]),_:1})]),_:1},8,["value","onRowExpand","onRowCollapse","expandedRows","selection"])])])],64)}}},a=ae(Oe);a.use(se,{ripple:!0});a.use(de);a.use(le);a.use(we);a.directive("tooltip",ce);a.directive("badge",ue);a.directive("ripple",ne);a.directive("styleclass",pe);a.directive("focustrap",me);a.component("Button",ie);a.component("DataTable",ve);a.component("Column",fe);a.component("ColumnGroup",Ce);a.component("Row",Se);a.component("Toast",ye);a.component("ConfirmDialog",he);a.component("Dropdown",_e);a.component("InputText",ge);a.component("Dialog",be);a.component("ProgressSpinner",xe);a.component("Calendar",Re);a.component("moment",I);a.mount("#vjs_reimbursementsApprovalTable");
