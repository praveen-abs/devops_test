import{d as u}from"./dayjs.min-2f06af28.js";import{a as w}from"./index-362795f3.js";import{G as g,I as A,ab as T,o as S,c as b,d as D,h as a,w as d,l as v,t as M,H as i,F as E,g as m}from"./toastservice.esm-d169f0d1.js";import{d as O}from"./pinia-78eb213f.js";const R=O("employeePayslipStore",()=>{const h=g(),t=g(),p=g(!1),P=new URLSearchParams(window.location.search);function s(){return P.has("uid")?P.get("uid"):""}async function n(){w.post("/payroll/paycheck/getEmployeeAllPayslipList",{uid:s()}).then(o=>{h.value=o.data.data})}async function _(o,e){let l=parseInt(u(e).month())+1,c=u(e).year();await w.post("/payroll/paycheck/getEmployeePayslipDetailsAsHTML",{uid:s(),user_code:o,month:l,year:c}).then(y=>{t.value=y.data,p.value=!0})}function f(o){const e=o,l=document.createElement("a"),c="convertedPDFFile.pdf";l.href=e,l.download=c,l.click()}async function L(o,e){console.log("Downloading payslip PDF.....");let l=parseInt(u(e).month())+1,c=u(e).year();await w.post("/payroll/paycheck/getEmployeePayslipDetailsAsPDF",{uid:s(),user_code:o,month:l,year:c}).then(y=>{if(console.log(" Response [downloadPayslipReleaseStatus] : "+JSON.stringify(y.data.data)),y.data.data){let r=y.data.data;r.startsWith("JVB")?(r="data:application/pdf;base64,"+r,f(r)):r.startsWith("data:application/pdf;base64")&&f(r)}else console.log("Response Url Not Found")})}return{array_employeePayslips_list:h,paySlipHTMLView:t,canShowPayslipView:p,getEmployeeAllPayslipList:n,getEmployeePayslipDetailsAsHTML:_,getEmployeePayslipDetailsAsPDF:L}});const k={class:"my-4"},N={class:"card flex justify-content-center inline-flex"},H=["innerHTML"],x={__name:"EmployeePayslips",setup(h){const t=R();A(async()=>{console.log("EmployeePayslips,vue loaded"),await t.getEmployeeAllPayslipList()});const p=g({PAYROLL_MONTH:{value:null,matchMode:T.STARTS_WITH,matchMode:T.EQUALS,matchMode:T.CONTAINS}});return(P,s)=>{const n=m("Column"),_=m("Button"),f=m("column"),L=m("DataTable"),o=m("Dialog");return S(),b(E,null,[D("div",k,[a(L,{value:i(t).array_employeePayslips_list,paginator:!0,rows:10,dataKey:"id",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],sortField:"PAYROLL_MONTH",sortOrder:-1,currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Records",responsiveLayout:"scroll",filters:p.value,"onUpdate:filters":s[0]||(s[0]=e=>p.value=e),filterDisplay:"menu",loading:P.loading2,globalFilterFields:["name"]},{default:d(()=>[a(n,{field:"PAYROLL_MONTH",header:"Month",sortable:!0},{body:d(e=>[v(M(i(u)(e.data.PAYROLL_MONTH).format("DD-MMM-YYYY")),1)]),_:1}),a(n,{field:"TOTAL_EARNED_GROSS",header:"Gross Pay"}),a(n,{field:"Reimbursements",header:"Reimbursements"},{body:d(e=>[v(M(0))]),_:1}),a(n,{field:"TOTAL_DEDUCTIONS",header:"Deductions"}),a(n,{field:"NET_TAKE_HOME",header:"Take Home"}),a(n,{header:"Action"},{body:d(e=>[a(_,{class:"btn-primary z-0",label:"View ",onClick:l=>i(t).getEmployeePayslipDetailsAsHTML("",e.data.PAYROLL_MONTH)},null,8,["onClick"])]),_:1}),a(f,{header:"Download"},{body:d(e=>[a(_,{class:"btn-primary z-0",label:"Download ",onClick:l=>i(t).getEmployeePayslipDetailsAsPDF("",e.data.PAYROLL_MONTH)},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters","loading"])]),D("div",N,[a(o,{visible:i(t).canShowPayslipView,"onUpdate:visible":s[1]||(s[1]=e=>i(t).canShowPayslipView=e),modal:"",header:"Payslip",style:{width:"58vw"}},{default:d(()=>[D("div",{innerHTML:i(t).paySlipHTMLView},null,8,H)]),_:1},8,["visible"])])],64)}}};export{x as _};
