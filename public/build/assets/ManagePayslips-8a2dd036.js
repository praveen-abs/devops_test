import{G as v,I as Y,o as b,c as D,d as o,h as s,H as f,w as y,a as A,t as E,F as H,g as C,J as z,P as B,K as W,R as j,u as I,v as O,L as J,Q as G,M as K,N as Q,A as q}from"./toastservice.esm-3137c6bd.js";import{T as X,B as Z,S as ee,b as ae,a as te}from"./styleclass.esm-144d12d2.js";import"./blockui.esm-1641b8a1.js";import{C as le}from"./confirmationservice.esm-ec2f14f9.js";import{s as se}from"./progressspinner.esm-0e6c68e2.js";import{s as oe}from"./calendar.esm-e5b274ce.js";import{d as ie,c as ne}from"./pinia-13c2ded6.js";import{a as x}from"./index-362795f3.js";const pe=ie("managePayslipStore",()=>{const S=v(),l=v(),k=v(),c=v(!1);async function h(i,r){c.value=!0,S.value="",await x.post("getAllEmployeesPayslipDetails",{month:i,year:r}).then(d=>{S.value=d.data.data}).finally(()=>{c.value=!1})}async function w(i,r,d){c.value=!0,await x.post("/payroll/paycheck/getEmployeePayslipDetailsAsHTML",{user_code:i,month:r,year:d}).then(u=>{k.value=u.data}).finally(()=>{c.value=!1})}async function P(i,r,d){c.value=!0,await x.post("/payroll/paycheck/getEmployeePayslipDetailsAsPDF",{user_code:i,month:r,year:d}).then(u=>{}).finally(()=>{c.value=!1})}async function g(i,r,d){console.log("sendMail_employeePayslip() : Sending mail to user : "+i),c.value=!0,x.post("/payroll/paycheck/sendMail_employeePayslip",{user_code:i,month:r,year:d}).then(u=>{console.log(" Response [sendMail_employeePayslip] : "+u.data.data)}).catch(u=>{console.log(u)}).finally(()=>{c.value=!1})}async function F(i,r,d,u){console.log("updatePayslipReleaseStatus() : Updating releasepayslip status to user : "+i);let p=new Date(l.value);x.post("/payroll/paycheck/updatePayslipReleaseStatus",{user_code:i,month:r,year:d,status:u}).then(e=>{console.log(" Response [updatePayslipReleaseStatus] : "+e.data.data)}).catch(e=>{console.log(e.data.data)}).finally(()=>{h(p.getMonth()+1,p.getFullYear())})}async function T(i,r,d,u){console.log("UpdateWithDrawStatus() : Updating withdraw :",i);let p=new Date(l.value);x.post("/payroll/paycheck/updatePayslipReleaseStatus",{user_code:i,month:r,year:d,status:u}).then(e=>{console.log(" Response [updatePayslipReleaseStatus] : "+e.data.data)}).catch(e=>{console.log(e.data.data)}).finally(()=>{h(p.getMonth()+1,p.getFullYear())})}function M(i,r,d){const u=i,p=document.createElement("a"),e=`${r}-${d}.pdf`;p.href=u,p.download=e,p.click()}async function L(i,r,d,u){console.log("Downloading payslip PDF....."),parseInt(dayjs(payroll_month).month())+1,dayjs(payroll_month).year(),await x.post("/payroll/paycheck/getEmployeePayslipDetailsAsPDF",{uid:getURLParams_UID(),user_code:i,month:formattedMonth,year:formattedYear}).then(p=>{if(console.log(" Response [downloadPayslipReleaseStatus] : "+JSON.stringify(p.data.data)),p.data.data){let e=p.data.data,t=p.data.emp_name,U=p.data.emp_month;e.startsWith("JVB")?(e="data:application/pdf;base64,"+e,M(e,t,U)):e.startsWith("data:application/pdf;base64")&&M(e)}else console.log("Response Url Not Found")})}return{array_employees_list:S,paySlipHTMLView:k,selectedPayRollDate:l,loading:c,getAllEmployeesPayslipDetails:h,getEmployeePayslipDetailsAsHTML:w,sendMail_employeePayslip:g,updatePayslipReleaseStatus:F,downloadPayslip:L,UpdateWithDrawStatus:T,getEmployeePayslipDetailsAsPDF:P}});const re={class:"d-flex justify-content-end"},de=o("label",{for:"",class:"my-2 text-lg font-semibold"},"Select Month",-1),ce={class:"my-4"},ue={class:"d-flex flex-column"},ye=["onClick"],me=["onClick"],fe={key:2,class:"text-success mt-2"},ve={key:3,class:"text-danger mt-2"},ge={key:0},he=o("h1",null," Payslip sent",-1),_e=[he],we={key:1},Pe=["onClick"],be=o("div",{class:"confirmation-content"},[o("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem"}}),o("span",null,"Are you sure you want to send Mail ?")],-1),De={class:"d-flex mt-11",style:{position:"relative",right:"-180px",width:"140px"}},xe=o("div",{class:"confirmation-content"},[o("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem"}}),o("span",null,"Are you sure you want to send Mail ?")],-1),ke={class:"d-flex mt-11",style:{position:"relative",right:"-180px",width:"140px"}},Re={class:"confirmation-content"},Ce=o("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem"}},null,-1),Se={class:"d-flex mt-11",style:{position:"relative",right:"-180px",width:"140px"}},Me={class:"confirmation-content"},$e=o("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem"}},null,-1),Fe={class:"d-flex mt-11",style:{position:"relative",right:"-180px",width:"140px"}},Te={class:"card flex justify-content-center inline-flex"},Le=["innerHTML"],Ue=o("h5",{style:{"text-align":"center"}},"Please wait...",-1),Ae={__name:"ManagePayslips",setup(S){const l=pe(),k=v(!1),c=v(!1),h=v(!1),w=v(!1),P=v(!1);v();const g=v();Y(()=>{l.selectedPayRollDate=new Date("03/03/2023"),l.getAllEmployeesPayslipDetails(l.selectedPayRollDate.getMonth()+1,l.selectedPayRollDate.getFullYear())});async function F(e){console.log("Showing payslip html for (user_code, month): "+e+" , "+parseInt(l.selectedPayRollDate.getMonth()+1)),await l.getEmployeePayslipDetailsAsHTML(e,l.selectedPayRollDate.getMonth()+1,l.selectedPayRollDate.getFullYear()),k.value=!0}function T(e){g.value=e,c.value=!0}function M(e){g.value=e,h.value=!0}function L(e){g.value=e,w.value=!0}async function i(e){await l.sendMail_employeePayslip(e,l.selectedPayRollDate.getMonth()+1,l.selectedPayRollDate.getFullYear()),c.value=!1}async function r(e){await l.updatePayslipReleaseStatus(e,l.selectedPayRollDate.getMonth()+1,l.selectedPayRollDate.getFullYear(),1),h.value=!1}async function d(e){g.value=e,P.value=!0}async function u(e){await l.UpdateWithDrawStatus(e,l.selectedPayRollDate.getMonth()+1,l.selectedPayRollDate.getFullYear(),0),P.value=!1}async function p(e){await l.downloadPayslip(e,l.selectedPayRollDate.getMonth()+1,l.selectedPayRollDate.getFullYear()),w.value=!1}return(e,t)=>{const U=C("Calendar"),m=C("Button"),_=C("Column"),N=C("DataTable"),R=C("Dialog"),V=C("ProgressSpinner");return b(),D(H,null,[o("div",re,[de,s(U,{view:"month",dateFormat:"mm/yy",class:"mx-4",modelValue:f(l).selectedPayRollDate,"onUpdate:modelValue":t[0]||(t[0]=a=>f(l).selectedPayRollDate=a),style:{border:"1px solid orange","border-radius":"7px",height:"38px"}},null,8,["modelValue"]),s(m,{class:"h-10 mb-2 btn btn-orange",label:"Generate",onClick:t[1]||(t[1]=a=>f(l).getAllEmployeesPayslipDetails(f(l).selectedPayRollDate.getMonth()+1,f(l).selectedPayRollDate.getFullYear()))})]),o("div",ce,[s(N,{value:f(l).array_employees_list,paginator:!0,rows:10,dataKey:"id",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Records",responsiveLayout:"scroll",filters:e.filters,"onUpdate:filters":t[2]||(t[2]=a=>e.filters=a),filterDisplay:"menu",loading:e.loading2,globalFilterFields:["name","status"]},{default:y(()=>[s(_,{headerStyle:"width: 3rem"}),s(_,{field:"user_code",header:"Employee Code",headerStyle:"width: 3rem"}),s(_,{field:"name",header:"Employee Name"}),s(_,{field:"email",header:"Personal Mail"}),s(_,{field:"is_payslip_released",header:"Payslip Status"},{body:y(a=>[o("div",ue,[a.data.is_payslip_released==1?(b(),D("button",{key:0,class:"btn z-0",style:{border:"1px solid navy"},onClick:$=>d(a.data.user_code)},"withdraw",8,ye)):(b(),D("button",{key:1,class:"btn-primary rounded z-0",style:{padding:"4px 0 !important","margin-top":"10px"},onClick:$=>M(a.data.user_code)},"Release payslip",8,me)),a.data.is_payslip_released==1?(b(),D("h1",fe," Released ")):A("",!0),a.data.is_payslip_released==0||a.data.is_payslip_released==null?(b(),D("h1",ve," Not Released ")):A("",!0)])]),_:1}),s(_,{field:"is_payslip_mail_sent",header:"Mail Status"},{body:y(a=>[a.data.is_payslip_mail_sent==1?(b(),D("div",ge,_e)):(b(),D("div",we,[o("button",{class:"btn-primary rounded z-0",onClick:$=>T(a.data.user_code)},"Send Payslip",8,Pe)]))]),_:1}),s(_,{header:"Download"},{body:y(a=>[s(m,{class:"btn-primary z-0",style:{},label:"Download",onClick:$=>L(a.data.user_code)},null,8,["onClick"])]),_:1}),s(_,{header:"View Payslip"},{body:y(a=>[s(m,{class:"btn-primary z-0",style:{},label:"View",onClick:$=>F(a.data.user_code)},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters","loading"])]),s(R,{header:"Confirmation",visible:c.value,"onUpdate:visible":t[5]||(t[5]=a=>c.value=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{default:y(()=>[be,o("div",De,[s(m,{class:"btn-primary mr-3 py-2",label:"Yes",icon:"pi pi-check",onClick:t[3]||(t[3]=a=>i(g.value)),autofocus:""}),s(m,{label:"No",icon:"pi pi-times",onClick:t[4]||(t[4]=a=>c.value=!1),class:"p-button-text py-2",autofocus:""})])]),_:1},8,["visible"]),s(R,{header:"Confirmation",visible:P.value,"onUpdate:visible":t[8]||(t[8]=a=>P.value=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{default:y(()=>[xe,o("div",ke,[s(m,{class:"btn-primary mr-3 py-2",label:"Yes",icon:"pi pi-check",onClick:t[6]||(t[6]=a=>u(g.value)),autofocus:""}),s(m,{label:"No",icon:"pi pi-times",onClick:t[7]||(t[7]=a=>P.value=!1),class:"p-button-text py-2",autofocus:""})])]),_:1},8,["visible"]),s(R,{header:"Confirmation",visible:h.value,"onUpdate:visible":t[11]||(t[11]=a=>h.value=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{default:y(()=>[o("div",Re,[Ce,o("span",null,"Are you sure you want to release payslip? "+E(f(l).name),1)]),o("div",Se,[s(m,{class:"btn-primary py-2 mr-3",label:"Yes",icon:"pi pi-check",onClick:t[9]||(t[9]=a=>r(g.value)),autofocus:""}),s(m,{label:"No",icon:"pi pi-times",onClick:t[10]||(t[10]=a=>h.value=!1),class:"p-button-text py-2",autofocus:""})])]),_:1},8,["visible"]),s(R,{header:"Confirmation",visible:w.value,"onUpdate:visible":t[14]||(t[14]=a=>w.value=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{default:y(()=>[o("div",Me,[$e,o("span",null,"Are you sure you want to download payslip? "+E(f(l).name),1)]),o("div",Fe,[s(m,{class:"btn-primary py-2 mr-3",label:"Yes",icon:"pi pi-check",onClick:t[12]||(t[12]=a=>p(g.value)),autofocus:""}),s(m,{label:"No",icon:"pi pi-times",onClick:t[13]||(t[13]=a=>w.value=!1),class:"p-button-text py-2",autofocus:""})])]),_:1},8,["visible"]),o("div",Te,[s(R,{visible:k.value,"onUpdate:visible":t[15]||(t[15]=a=>k.value=a),modal:"",header:"Payslip",style:{width:"50vw"}},{default:y(()=>[o("div",{innerHTML:f(l).paySlipHTMLView},null,8,Le)]),_:1},8,["visible"])]),s(R,{header:"Header",visible:f(l).loading,"onUpdate:visible":t[16]||(t[16]=a=>f(l).loading=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"25vw"},modal:!0,closable:!1,closeOnEscape:!1},{header:y(()=>[s(V,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:"2s","aria-label":"Custom ProgressSpinner"})]),footer:y(()=>[Ue]),_:1},8,["visible"])],64)}}},n=z(Ae),Ee=ne();n.use(B,{ripple:!0});n.use(le);n.use(W);n.use(Ee);n.directive("tooltip",X);n.directive("badge",Z);n.directive("ripple",j);n.directive("styleclass",ee);n.directive("focustrap",I);n.component("Button",O);n.component("DataTable",ae);n.component("Column",te);n.component("ConfirmDialog",J);n.component("Toast",G);n.component("Dialog",K);n.component("Dropdown",Q);n.component("ProgressSpinner",se);n.component("InputText",q);n.component("Calendar",oe);n.mount("#vjs_manage_payslips");
