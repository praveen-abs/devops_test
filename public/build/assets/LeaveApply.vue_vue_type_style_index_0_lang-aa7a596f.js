import{d as V}from"./pinia-641035e3.js";import{u as re}from"./toastservice.esm-8d63d505.js";import{a as h}from"./index-362795f3.js";import{h as b}from"./moment-fbc5633a.js";import{S as W}from"./Service-4ef425c0.js";import{Q as s,a5 as Q,$ as ee,W as Z}from"./inputnumber.esm-e362c3ab.js";const ce=V("calendar",()=>{const r=ae();W();const u=s(new Date().getFullYear()),l=s(new Date().getMonth()),e=s(new Date().getDate()),E=Q(()=>u.value),A=Q(()=>l.value),_=Q(()=>e.value);function f(m){u.value=u.value+m}function v(m){u.value=u.value-m}function y(m){if(r.canShowLoading=!0,l.value==11){f(1),l.value=0;return}l.value=l.value+m,console.log(r.isTeamOrg),r.getSelectedEmployeeTeamDetails(r.currentlySelectedTeamMemberUserId),r.getSelectedEmployeeOrgDetails(r.currentlySelectedOrgMemberUserId),r.getSelectedEmployeeAttendance()}function g(m){if(r.canShowLoading=!0,l.value==0){v(1),l.value=11;return}l.value=l.value-m,r.getSelectedEmployeeTeamDetails(r.currentlySelectedTeamMemberUserId),r.getSelectedEmployeeOrgDetails(r.currentlySelectedOrgMemberUserId),r.getSelectedEmployeeAttendance()}function M(m){l.value=m}function D(m){u.value=m}function d(){u.value=new Date().getFullYear(),l.value=new Date().getMonth(),e.value=new Date().getDate()}return{year:u,month:l,day:e,getYear:E,getMonth:A,getDay:_,incrementYear:f,incrementMonth:y,decrementMonth:g,setMonth:M,setYear:D,resetDate:d}});ee("$swal");const ae=V("Timesheet",()=>{const r=ce(),u=W(),l=s(!0),e=s(!1),E=s("single"),A=s("Classic"),_=s(),f=s({}),v=s({}),y=s({}),g=s({}),M=s(),D=s(),d=s({}),m=s({}),O=s(!1),j=s(!1),U=s(!1),T=s(!1),P=s(!1),J=s(!1),$=s(),G=s(0),x=s(),R=s(),N=s(),H=s(),F=async(a,o,n)=>{l.value=!0;let p="/fetch-attendance-user-timesheet";try{return await h.post(p,{month:o+1,year:n,user_code:a}).then(I=>(console.log(" getEmployeeAttendance() : "+Object.values(I.data)),I.data))}catch(I){return console.error("Error [ getEmployeeAttendance() ]:",I),null}},w=async()=>{try{return l.value=!0,await F(u.current_user_code,r.getMonth,r.getYear).then(a=>{if(console.log("getSelectedEmployeeAttendance() : "+a),a)console.log("Selected employee attendance : "+a.data),$.value=Object.values(a.data),G.value=Object.values(a.data).length;else return null})}catch(a){console.error("Error [ getSelectedEmployeeAttendance() ]:",a)}finally{l.value=!1}},t=(a,o)=>{E.value=o,l.value=!0,x.value=a,F(a,r.getMonth,r.getYear).then(n=>{R.value=Object.values(n.data)}).catch(n=>{console.log("Error[ getSelectedEmployeeTeamDetails)() ]",n)}).finally(()=>{l.value=!1})},K=async(a,o,n)=>{E.value=o,_.value=n,console.log("employee list select function  ::",_.value),l.value=!0,N.value=a,await F(a,r.getMonth,r.getYear).then(p=>{console.log(" getSelectedEmployeeOrgDetails() : "+Object.values(p.data)),H.value=Object.values(p.data)}).finally(()=>{l.value=!1})},X=async a=>h.post("/fetch-team-members",{user_code:a}),i=async()=>h.get("/fetch-org-members"),c=a=>a=="biometric"?"fas fa-fingerprint fs-12":a=="web"?"fa fa-laptop fs-12":a=="mobile"?"fa fa-mobile-phone fs-12":"",S=(a,o)=>{let n=_.value;if(u.current_user_role===2){let p={admin_user_code:u.current_user_code,user_code:n,regularization_type:o,attendance_date:a.date,user_time:a.checkin_time,regularize_time:o=="LC"||o=="MIP"?L(M.value):o=="EG"||o=="MOP"?L(D.value):"",reason:a.reason,custom_reason:a.custom_reason?a.custom_reason:""};return M.value=null,D.value=null,p}else{let p={user_code:u.current_user_code,regularization_type:o,attendance_date:a.date,user_time:a.checkin_time,regularize_time:o=="LC"||o=="MIP"?L(M.value):o=="EG"||o=="MOP"?L(D.value):"",reason:a.reason,custom_reason:a.custom_reason?a.custom_reason:""};return M.value=null,D.value=null,p}},C=a=>{U.value=!0,y.value={...a}},k=()=>{l.value=!0;let a;_&&u.current_user_role==2?a="/checkAttendanceEmployeeAdminStatus":a="/attendance-req-regularization",h.post(a,S(y.value,"LC")).then(o=>{w();let n=o.data.message;console.log(n),o.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${n}`,"error")}).finally(()=>{l.value=!1})},Y=a=>{T.value=!0,g.value={...a}},z=()=>{let a;_&&u.current_user_role==2?a="/checkAttendanceEmployeeAdminStatus":a="/attendance-req-regularization",l.value=!0,h.post(a,S(g.value,"EG")).then(o=>{w();let n=o.data.message;console.log(n),o.data.status=="success"?Swal.fire("Success!","Attendance Regularized Successful","success"):Swal.fire("Error",`${n}`,"error")}).finally(()=>{l.value=!1})},B=a=>{j.value=!0,v.value={...a}},te=()=>{l.value=!0;let a;_&&u.current_user_role==2?a="/checkAttendanceEmployeeAdminStatus":a="/attendance-req-regularization",h.post(a,S(v.value,"MIP")).then(o=>{w();let n=o.data.message;console.log(n),o.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${n}`,"error")}).finally(()=>{l.value=!1})},se=a=>{O.value=!0,f.value={...a}},le=()=>{let a;_&&u.current_user_role==2?a="/checkAttendanceEmployeeAdminStatus":a="/attendance-req-regularization",l.value=!0,h.post(a,S(f.value,"MOP")).then(o=>{w();let n=o.data.message;console.log(n),o.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${n}`,"error")}).finally(()=>{l.value=!1})},oe=()=>{l.value=!0;let a=_.value;console.log("currentlySelectedUser :: ",a);let o;_&&u.current_user_role==2?o="/checkAbsentEmployeeAdminStatus":o="/attendance-req-regularization",_&&u.current_user_role==2?h.post(o,{admin_user_code:u.current_user_code,user_code:a,attendance_date:d.value.date,regularization_type:"Absent Regularization",checkin_time:L(d.value.start_time),checkout_time:L(d.value.end_time),reason:d.value.reason,custom_reason:d.value.custom_reason?d.value.custom_reason:""}).then(n=>{w();let p=n.data.message;n.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${p}`,"error")}).finally(()=>{l.value=!1}):h.post(o,{user_code:u.current_user_code,attendance_date:d.value.date,regularization_type:"Absent Regularization",checkin_time:L(d.value.start_time),checkout_time:L(d.value.end_time),reason:d.value.reason,custom_reason:d.value.custom_reason?d.value.custom_reason:""}).then(n=>{w();let p=n.data.message;n.data.status=="success"?Swal.fire("Good job!","Attendance Regularized Successful","success"):Swal.fire("Fill!",`${p}`,"error")}).finally(()=>{l.value=!1})},ne=a=>{P.value=!0,m.value=a},L=a=>{if(a){const[o,n]=a.split(" "),[p,I]=o.split(":");let q=parseInt(p);return n==="PM"&&q!==12?q+=12:n==="AM"&&q===12&&(q=0),`${q.toString().padStart(2,"0")}:${I}:00`}};return{getEmployeeAttendance:F,currentEmployeeAttendance:$,currentEmployeeAttendanceLength:G,getSelectedEmployeeOrgDetails:K,getTeamList:X,getOrgList:i,getSelectedEmployeeTeamDetails:t,getSelectedEmployeeAttendance:w,CurrentlySelectedUser:_,classicTimesheetSidebar:J,currentlySelectedTeamMemberUserId:x,currentlySelectedTeamMemberAttendance:R,currentlySelectedOrgMemberUserId:N,currentlySelectedOrgMemberAttendance:H,canShowLoading:l,isManager:e,isTeamOrg:E,findAttendanceMode:c,AttendanceLateOrMipRegularization:M,AttendanceEarylOrMopRegularization:D,onClickShowLcRegularization:C,applyMopRegularization:le,mopDetails:f,dialog_Mop:O,onClickShowEgRegularization:Y,applyMipRegularization:te,mipDetails:v,dialog_Mip:j,onClickShowMipRegularization:B,applyLcRegularization:k,lcDetails:y,dialog_Lc:U,onClickShowMopRegularization:se,applyEgRegularization:z,egDetails:g,dialog_Eg:T,dialog_Selfie:P,onClickSViewSelfie:ne,selfieDetails:m,switchTimesheet:A,absentRegularizationDetails:d,applyAbsentRegularization:oe}});ee("$swal");const ye=V("useLeaveService",()=>{const r=re(),u=W(),l=ae(),e=Z({current_login_user:"",selected_leave:"",full_day_leave_date:"",half_day_leave_date:"",half_day_leave_session:"",radiobtn_full_day:"",radiobtn_half_day:"",radiobtn_custom:"",custom_start_date:"",custom_end_date:"",custom_total_days:"",permission_date:"",permission_start_time:"",permission_total_time:"",permission_end_time:"",compensatory_leaves:"",compensatory_leaves_dates:"",selected_compensatory_leaves:"",compensatory_start_date:"",compensatory_total_days:"",compensatory_end_date:"",notifyTo:"",leave_reason:"",leave_request_error_message:""}),E=s(!1),A=s(!0),_=s(!0),f=s(!1),v=s(!1),y=s(!1),g=s(!1),M=s(),D=s();let d=new Date;const m=s(!1),O=s(!1),j=s(!1),U=s(!1);let T=new Date;T.setDate(d.getDate()-1),M.value=[d,T];const P=s(),J=()=>{e.radiobtn_full_day=="full_day"?_.value=!0:_.value=!1,_.value=!0,v.value=!1,y.value=!1,f.value=!1,g.value=!1},$=()=>{e.radiobtn_half_day=="half_day"?f.value=!0:f.value=!1,f.value=!0,v.value=!1,y.value=!1,_.value=!1,g.value=!1},G=()=>{e.radiobtn_custom=="custom"?v.value=!0:v.value=!1,v.value=!0,y.value=!1,f.value=!1,_.value=!1,g.value=!1},x=()=>{v.value==!0&&(e.custom_start_date.length<0||e.custom_start_date=="")&&r.add({severity:"info",summary:"Info Message",detail:"Select Start date",life:3e3}),y.value==!0&&(e.permission_start_time<0||e.permission_start_time=="")&&r.add({severity:"info",summary:"Info Message",detail:"Select Start Time",life:3e3}),new Date().toJSON().slice(0,10);var i=new Date(e.custom_start_date);console.log(e.custom_start_date);var c=new Date(e.custom_end_date);console.log(e.custom_end_date);var Y=c.getTime()-i.getTime();console.log("Differenece"+Y);var z=(Y/(1e3*60*60*24)).toFixed(0);let S=z;console.log(S),e.custom_total_days=parseInt(S)+1,console.log(e.custom_total_days);var C=new Date(e.compensatory_start_date);console.log(e.compensatory_start_date);var k=new Date(e.compensatory_end_date);console.log(e.compensatory_end_date);var Y=k.getTime()-C.getTime();console.log("Differenece"+Y);var z=(Y/(1e3*60*60*24)).toFixed(0);let B=z;console.log(B),e.compensatory_total_days=parseInt(B)+1,console.log(e.compensatory_total_days)},R=()=>{let i=b(e.full_day_leave_date).format("YYYY-MM-DD"),c=e.permission_start_time.toString();c=i+" "+c.substring(16,24);let S=e.permission_end_time.toString();S=i+" "+S.substring(16,24),console.log();let C=new Date(e.permission_start_time).getTime(),k=new Date(e.permission_end_time).getTime();console.log("start"+C,"end"+k);var Y=((k-C)/1e3/60/60).toFixed(0);e.permission_total_time=Y,console.log(Y)},N=()=>{e.selected_leave.includes("Permission")?(y.value=!0,A.value=!1,f.value=!1,v.value=!1,g.value=!1,_.value=!1):e.selected_leave.includes("Compensatory")?(g.value=!0,y.value=!1,_.value=!1,f.value=!1,v.value=!1,A.value=!1,w(),e.compensatory_leaves_dates=b(e.compensatory_leaves.emp_attendance_date).format("dddd DD-MMM-YYYY"),console.log("kn"+e.compensatory_leaves.emp_attendance_date)):e.selected_leave=="Select"?(g.value=!1,y.value=!1,_.value=!0,f.value=!1,v.value=!1,A.value=!0):(y.value=!1,g.value=!1,A.value=!0,_.value=!0)},H=()=>{h.get("/currentUser").then(i=>{e.current_login_user=i.data,O.value=!1}).catch(i=>{console.log(i)})},F=()=>{h.get("/fetch-leave-policy-details").then(i=>{console.log(i.data),D.value=i.data})},w=()=>{e.current_login_user,h.get("/fetch-employee-unused-compensatory-days").then(i=>{e.compensatory_leaves=i.data}).catch(i=>{console.log(i)})},t=Z({leave_type_id:1,leave_Request_date:b().format("YYYY-MM-DD  HH:mm:ss"),leave_type_name:"",leave_session:"",start_date:"",end_date:"",no_of_days:"",hours_diff:"",notify_to:"",leave_reason:"",compensatory_leave_id:[],user_type:"Employee"});return{leaveApplyDailog:E,leave_data:e,invalidDate:T,today:d,invalidDates:M,toast:r,leave_Request_data:t,leave_types:D,data_checking:O,Email_Service:j,Email_Error:U,selected_compensatory_leaves:P,half_day:$,full_day:J,custom_day:G,Permission:N,Submit:async()=>{if(t.leave_type_name=e.selected_leave,e.radiobtn_full_day=="full_day")console.log("Full day leave : "+e.full_day_leave_date),t.no_of_days=1,t.start_date=b(e.full_day_leave_date).format("YYYY-MM-DD"),t.end_date=t.start_date,t.leave_session="";else if(e.radiobtn_half_day=="half_day")if(console.log("Applying half-day leave on : "+e.half_day_leave_date),t.no_of_days=.5,console.log("half day leave date"+e.half_day_leave_date),t.start_date=b(e.half_day_leave_date).format("YYYY-MM-DD"),t.end_date=t.start_date,e.half_day_leave_session=="forenoon")t.leave_session="FN";else if(e.half_day_leave_session=="afternoon")t.leave_session="AN";else{r.add({severity:"info",summary:"Select Session",detail:"Select Leave Session",life:3e3});return}else if(e.radiobtn_custom=="custom")t.start_date=b(e.custom_start_date).format("YYYY-MM-DD"),t.end_date=b(e.custom_end_date).format("YYYY-MM-DD"),t.no_of_days=e.custom_total_days,t.leave_session="";else if(e.selected_leave.includes("Compensatory")){t.start_date=b(e.compensatory_start_date).format("YYYY-MM-DD"),t.end_date=b(e.compensatory_end_date).format("YYYY-MM-DD"),t.no_of_days=e.compensatory_total_days;let c=Object.values(e.selected_compensatory_leaves).length;console.log("Selected Compensatory No.of days : "+e.compensatory_total_days),console.log("Selected Compensatory Leaves : "+c);const S=Object.values(e.selected_compensatory_leaves);if(parseInt(e.compensatory_total_days)!=c){r.add({severity:"info",summary:"Error",detail:"Compensatory leaves doesnt match with available leave days",life:3e3});return}else S.map(C=>{let k=C.emp_attendance_id;t.compensatory_leave_id.push(k),console.log(t.compensatory_leave_id)})}else e.selected_leave.includes("Permission")?(t.start_date=b(e.permission_date).format("YYYY-MM-DD"),t.end_date=t.start_date,t.hours_diff=e.permission_total_time):r.add({severity:"info",summary:"Info Message",detail:"Select Leave",life:3e3});t.notify_to=e.notifyTo,t.leave_reason=e.leave_reason,m.value=!0,console.log(t),O.value=!0;let i;u.current_user_role==2&&l.CurrentlySelectedUser?(console.log(l.CurrentlySelectedUser),i="applyLeaveRequest_AdminRole",h.post(i,{admin_user_code:u.current_user_code,user_code:l.CurrentlySelectedUser,leave_request_date:t.leave_Request_date,leave_type_name:t.leave_type_name,leave_session:t.leave_session,start_date:t.start_date,end_date:t.end_date,no_of_days:t.no_of_days,hours_diff:t.hours_diff,compensatory_work_days_ids:t.compensatory_leave_id,notify_to:t.notify_to,leave_reason:t.leave_reason,user_type:t.user_type}).then(c=>{O.value=!1,console.log(c.data.messege),c.data.status=="success"&&Swal.fire("Success",c.data.message,"success"),c.data.status=="failure"&&Swal.fire("Failure",c.data.message,"error"),console.log("Email status"+c.data.status)}).catch(c=>{console.log(c)}).finally(()=>{E.value=!1})):(i="/applyLeaveRequest",h.post(i,{user_code:u.current_user_code,leave_request_date:t.leave_Request_date,leave_type_name:t.leave_type_name,leave_session:t.leave_session,start_date:t.start_date,end_date:t.end_date,no_of_days:t.no_of_days,hours_diff:t.hours_diff,compensatory_work_days_ids:t.compensatory_leave_id,notify_to:t.notify_to,leave_reason:t.leave_reason,user_type:t.user_type}).then(c=>{O.value=!1,console.log(c.data.messege),c.data.status=="success"&&Swal.fire("Success",c.data.message,"success"),c.data.status=="failure"&&Swal.fire("Failure",c.data.message,"error"),console.log("Email status"+c.data.status)}).catch(c=>{console.log(c)}).finally(()=>{E.value=!1}))},ReloadPage:()=>{location.reload()},dayCalculation:x,time_difference:R,get_user:H,get_leave_types:F,get_compensatroy_leaves:w,full_day_format:_,half_day_format:f,custom_format:v,Permission_format:y,compensatory_format:g,TotalNoOfDays:A,RequiredField:m}});export{ce as a,ae as b,ye as u};
