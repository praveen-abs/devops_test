import{G as v,I as Y,o as D,c as x,d as o,h as s,H as f,w as m,a as A,t as E,F as H,g as S,J as z,P as B,K as W,R as j,u as I,v as O,L as J,Q as G,M as K,N as Q,A as q}from"./toastservice.esm-df672d85.js";import{T as X,B as Z,S as ee,b as ae,a as te}from"./styleclass.esm-0f558278.js";import"./blockui.esm-21aea155.js";import{C as le}from"./confirmationservice.esm-9901cfc7.js";import{s as se}from"./progressspinner.esm-426d2ed7.js";import{s as oe}from"./calendar.esm-f3386839.js";import{d as ie,c as ne}from"./pinia-00b0a64a.js";import{a as k}from"./index-362795f3.js";const pe=ie("managePayslipStore",()=>{const M=v(),t=v(),R=v(),d=v(!1);async function _(i,p){d.value=!0,M.value="",await k.post("getAllEmployeesPayslipDetails",{month:i,year:p}).then(r=>{M.value=r.data.data}).finally(()=>{d.value=!1})}async function P(i,p,r){d.value=!0,await k.post("/payroll/paycheck/getEmployeePayslipDetailsAsHTML",{user_code:i,month:p,year:r}).then(c=>{R.value=c.data}).finally(()=>{d.value=!1})}async function b(i,p,r){d.value=!0,await k.post("/payroll/paycheck/getEmployeePayslipDetailsAsPDF",{user_code:i,month:p,year:r}).then(c=>{}).finally(()=>{d.value=!1})}async function g(i,p,r){console.log("sendMail_employeePayslip() : Sending mail to user : "+i),d.value=!0,k.post("/payroll/paycheck/sendMail_employeePayslip",{user_code:i,month:p,year:r}).then(c=>{console.log(" Response [sendMail_employeePayslip] : "+c.data.data)}).catch(c=>{console.log(c)}).finally(()=>{d.value=!1})}async function T(i,p,r,c){console.log("updatePayslipReleaseStatus() : Updating releasepayslip status to user : "+i);let u=new Date(t.value);k.post("/payroll/paycheck/updatePayslipReleaseStatus",{user_code:i,month:p,year:r,status:c}).then(l=>{console.log(" Response [updatePayslipReleaseStatus] : "+l.data.data)}).catch(l=>{console.log(l.data.data)}).finally(()=>{_(u.getMonth()+1,u.getFullYear())})}async function L(i,p,r,c){console.log("UpdateWithDrawStatus() : Updating withdraw :",i);let u=new Date(t.value);k.post("/payroll/paycheck/updatePayslipReleaseStatus",{user_code:i,month:p,year:r,status:c}).then(l=>{console.log(" Response [updatePayslipReleaseStatus] : "+l.data.data)}).catch(l=>{console.log(l.data.data)}).finally(()=>{_(u.getMonth()+1,u.getFullYear())})}function $(i,p,r){const c=i,u=document.createElement("a"),l=`${p}-${r}.pdf`;u.href=c,u.download=l,u.click()}async function U(i,p,r,c){console.log("Downloading payslip PDF.....");let u=parseInt(dayjs(payroll_month).month())+1,l=dayjs(payroll_month).year();await k.post("/payroll/paycheck/getEmployeePayslipDetailsAsPDF",{uid:getURLParams_UID(),user_code:i,month:u,year:l}).then(e=>{if(console.log(" Response [downloadPayslipReleaseStatus] : "+JSON.stringify(e.data.data)),e.data.data){let w=e.data.data,y=e.data.emp_name,h=e.data.emp_month;w.startsWith("JVB")?(w="data:application/pdf;base64,"+w,$(w,y,h)):w.startsWith("data:application/pdf;base64")&&$(w)}else console.log("Response Url Not Found")})}return{array_employees_list:M,paySlipHTMLView:R,selectedPayRollDate:t,loading:d,getAllEmployeesPayslipDetails:_,getEmployeePayslipDetailsAsHTML:P,sendMail_employeePayslip:g,updatePayslipReleaseStatus:T,downloadPayslip:U,UpdateWithDrawStatus:L,getEmployeePayslipDetailsAsPDF:b}});const re={class:"d-flex justify-content-end"},de=o("label",{for:"",class:"my-2 text-lg font-semibold"},"Select Month",-1),ce={class:"my-4"},ue={class:"d-flex flex-column"},ye=["onClick"],me=["onClick"],fe={key:2,class:"text-success mt-2"},ve={key:3,class:"text-danger mt-2"},ge={key:0},he=o("h1",null," Payslip sent",-1),_e=[he],we={key:1},Pe=["onClick"],be=o("div",{class:"confirmation-content"},[o("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem"}}),o("span",null,"Are you sure you want to send Mail ?")],-1),De={class:"d-flex mt-11",style:{position:"relative",right:"-180px",width:"140px"}},xe=o("div",{class:"confirmation-content"},[o("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem"}}),o("span",null,"Are you sure you want to send Mail ?")],-1),ke={class:"d-flex mt-11",style:{position:"relative",right:"-180px",width:"140px"}},Re={class:"confirmation-content"},Ce=o("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem"}},null,-1),Se={class:"d-flex mt-11",style:{position:"relative",right:"-180px",width:"140px"}},Me={class:"confirmation-content"},$e=o("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem"}},null,-1),Fe={class:"d-flex mt-11",style:{position:"relative",right:"-180px",width:"140px"}},Te={class:"card flex justify-content-center inline-flex"},Le=["innerHTML"],Ue=o("h5",{style:{"text-align":"center"}},"Please wait...",-1),Ae={__name:"ManagePayslips",setup(M){const t=pe(),R=v(!1),d=v(!1),_=v(!1),P=v(!1),b=v(!1);v();const g=v();Y(()=>{t.selectedPayRollDate=new Date("03/03/2023"),t.getAllEmployeesPayslipDetails(t.selectedPayRollDate.getMonth()+1,t.selectedPayRollDate.getFullYear())});async function T(l){console.log("Showing payslip html for (user_code, month): "+l+" , "+parseInt(t.selectedPayRollDate.getMonth()+1)),await t.getEmployeePayslipDetailsAsHTML(l,t.selectedPayRollDate.getMonth()+1,t.selectedPayRollDate.getFullYear()),R.value=!0}function L(l){g.value=l,d.value=!0}function $(l){g.value=l,_.value=!0}function U(l){g.value=l,P.value=!0}async function i(l){await t.sendMail_employeePayslip(l,t.selectedPayRollDate.getMonth()+1,t.selectedPayRollDate.getFullYear()),d.value=!1}async function p(l){await t.updatePayslipReleaseStatus(l,t.selectedPayRollDate.getMonth()+1,t.selectedPayRollDate.getFullYear(),1),_.value=!1}async function r(l){g.value=l,b.value=!0}async function c(l){await t.UpdateWithDrawStatus(l,t.selectedPayRollDate.getMonth()+1,t.selectedPayRollDate.getFullYear(),0),b.value=!1}async function u(l){await t.downloadPayslip(l,t.selectedPayRollDate.getMonth()+1,t.selectedPayRollDate.getFullYear()),P.value=!1}return(l,e)=>{const w=S("Calendar"),y=S("Button"),h=S("Column"),N=S("DataTable"),C=S("Dialog"),V=S("ProgressSpinner");return D(),x(H,null,[o("div",re,[de,s(w,{view:"month",dateFormat:"mm/yy",class:"mx-4",modelValue:f(t).selectedPayRollDate,"onUpdate:modelValue":e[0]||(e[0]=a=>f(t).selectedPayRollDate=a),style:{border:"1px solid orange","border-radius":"7px",height:"38px"}},null,8,["modelValue"]),s(y,{class:"h-10 mb-2 btn btn-orange",label:"Generate",onClick:e[1]||(e[1]=a=>f(t).getAllEmployeesPayslipDetails(f(t).selectedPayRollDate.getMonth()+1,f(t).selectedPayRollDate.getFullYear()))})]),o("div",ce,[s(N,{value:f(t).array_employees_list,paginator:!0,rows:10,dataKey:"id",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Records",responsiveLayout:"scroll",filters:l.filters,"onUpdate:filters":e[2]||(e[2]=a=>l.filters=a),filterDisplay:"menu",loading:l.loading2,globalFilterFields:["name","status"]},{default:m(()=>[s(h,{headerStyle:"width: 3rem"}),s(h,{field:"user_code",header:"Employee Code",headerStyle:"width: 3rem"}),s(h,{field:"name",header:"Employee Name"}),s(h,{field:"email",header:"Personal Mail"}),s(h,{field:"is_payslip_released",header:"Payslip Status"},{body:m(a=>[o("div",ue,[a.data.is_payslip_released==1?(D(),x("button",{key:0,class:"btn z-0",style:{border:"1px solid navy"},onClick:F=>r(a.data.user_code)},"withdraw",8,ye)):(D(),x("button",{key:1,class:"btn-primary rounded z-0",style:{padding:"4px 0 !important","margin-top":"10px"},onClick:F=>$(a.data.user_code)},"Release payslip",8,me)),a.data.is_payslip_released==1?(D(),x("h1",fe," Released ")):A("",!0),a.data.is_payslip_released==0||a.data.is_payslip_released==null?(D(),x("h1",ve," Not Released ")):A("",!0)])]),_:1}),s(h,{field:"is_payslip_mail_sent",header:"Mail Status"},{body:m(a=>[a.data.is_payslip_mail_sent==1?(D(),x("div",ge,_e)):(D(),x("div",we,[o("button",{class:"btn-primary rounded z-0",onClick:F=>L(a.data.user_code)},"Send Payslip",8,Pe)]))]),_:1}),s(h,{header:"Download"},{body:m(a=>[s(y,{class:"btn-primary z-0",style:{},label:"Download",onClick:F=>U(a.data.user_code)},null,8,["onClick"])]),_:1}),s(h,{header:"View Payslip"},{body:m(a=>[s(y,{class:"btn-primary z-0",style:{},label:"View",onClick:F=>T(a.data.user_code)},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters","loading"])]),s(C,{header:"Confirmation",visible:d.value,"onUpdate:visible":e[5]||(e[5]=a=>d.value=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{default:m(()=>[be,o("div",De,[s(y,{class:"btn-primary mr-3 py-2",label:"Yes",icon:"pi pi-check",onClick:e[3]||(e[3]=a=>i(g.value)),autofocus:""}),s(y,{label:"No",icon:"pi pi-times",onClick:e[4]||(e[4]=a=>d.value=!1),class:"p-button-text py-2",autofocus:""})])]),_:1},8,["visible"]),s(C,{header:"Confirmation",visible:b.value,"onUpdate:visible":e[8]||(e[8]=a=>b.value=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{default:m(()=>[xe,o("div",ke,[s(y,{class:"btn-primary mr-3 py-2",label:"Yes",icon:"pi pi-check",onClick:e[6]||(e[6]=a=>c(g.value)),autofocus:""}),s(y,{label:"No",icon:"pi pi-times",onClick:e[7]||(e[7]=a=>b.value=!1),class:"p-button-text py-2",autofocus:""})])]),_:1},8,["visible"]),s(C,{header:"Confirmation",visible:_.value,"onUpdate:visible":e[11]||(e[11]=a=>_.value=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{default:m(()=>[o("div",Re,[Ce,o("span",null,"Are you sure you want to release payslip? "+E(f(t).name),1)]),o("div",Se,[s(y,{class:"btn-primary py-2 mr-3",label:"Yes",icon:"pi pi-check",onClick:e[9]||(e[9]=a=>p(g.value)),autofocus:""}),s(y,{label:"No",icon:"pi pi-times",onClick:e[10]||(e[10]=a=>_.value=!1),class:"p-button-text py-2",autofocus:""})])]),_:1},8,["visible"]),s(C,{header:"Confirmation",visible:P.value,"onUpdate:visible":e[14]||(e[14]=a=>P.value=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"350px"},modal:!0},{default:m(()=>[o("div",Me,[$e,o("span",null,"Are you sure you want to download payslip? "+E(f(t).name),1)]),o("div",Fe,[s(y,{class:"btn-primary py-2 mr-3",label:"Yes",icon:"pi pi-check",onClick:e[12]||(e[12]=a=>u(g.value)),autofocus:""}),s(y,{label:"No",icon:"pi pi-times",onClick:e[13]||(e[13]=a=>P.value=!1),class:"p-button-text py-2",autofocus:""})])]),_:1},8,["visible"]),o("div",Te,[s(C,{visible:R.value,"onUpdate:visible":e[15]||(e[15]=a=>R.value=a),modal:"",header:"Payslip",style:{width:"50vw"}},{default:m(()=>[o("div",{innerHTML:f(t).paySlipHTMLView},null,8,Le)]),_:1},8,["visible"])]),s(C,{header:"Header",visible:f(t).loading,"onUpdate:visible":e[16]||(e[16]=a=>f(t).loading=a),breakpoints:{"960px":"75vw","640px":"90vw"},style:{width:"25vw"},modal:!0,closable:!1,closeOnEscape:!1},{header:m(()=>[s(V,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:"2s","aria-label":"Custom ProgressSpinner"})]),footer:m(()=>[Ue]),_:1},8,["visible"])],64)}}},n=z(Ae),Ee=ne();n.use(B,{ripple:!0});n.use(le);n.use(W);n.use(Ee);n.directive("tooltip",X);n.directive("badge",Z);n.directive("ripple",j);n.directive("styleclass",ee);n.directive("focustrap",I);n.component("Button",O);n.component("DataTable",ae);n.component("Column",te);n.component("ConfirmDialog",J);n.component("Toast",G);n.component("Dialog",K);n.component("Dropdown",Q);n.component("ProgressSpinner",se);n.component("InputText",q);n.component("Calendar",oe);n.mount("#vjs_manage_payslips");
